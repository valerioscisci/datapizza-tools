# Thought Process

- Configurazione iniziale del progetto: creati agenti `datapizza-tools-*` indicando le regole di coding, stili e best practice sia per il fe che per il be
- Aggiornato `CLAUDE.md` con le istruzioni da eseguire ad ogni prompt, commit e per migliorare la gestione del contesto
- Aggiunte istruzioni post-prompt in `CLAUDE.md`: aggiornamento automatico di README.md, THOUGHT_PROCESS.md e agenti dopo ogni prompt completato
- **Visione del progetto**: il mercato del lavoro tech nei prossimi 6-12 mesi sara' stravolto dall'introduzione dei workflow agentici. Si stima che il 60-70% dei lavori digitali saranno impattati. Datapizza deve posizionarsi come punto di riferimento per aiutare gli sviluppatori a navigare questo cambiamento, acquisire nuove competenze e trovare nuovi ruoli
- **Scelte tecniche**: SQLite locale per comodita' e zero costi di hosting nella fase iniziale. FastAPI per lo sviluppo rapido e la possibilita' di deploy su AWS o Vercel (versione Python scelta per compatibilita' con altri progetti esistenti). Next.js con App Router come standard per tutti i nuovi progetti
- **Funzionalita' core pianificate**: (1) replicare e migliorare la job board esistente di Datapizza, (2) profili candidato con tech stack, notifiche giornaliere su corsi AI e progetti di reskilling (newsletter o bot Telegram), (3) "Craft Your Developer" - prodotto B2B a pagamento dove le aziende possono progettare percorsi formativi per candidati specifici e assumerli dopo il reskilling
- **Flusso "Craft Your Developer"**: le aziende navigano i profili dei candidati in cerca di lavoro, selezionano un candidato, progettano un training program personalizzato con corsi e competenze AI necessarie, e poi lo assumono. Questo flusso sara' probabilmente a pagamento per l'azienda
- **Ralph Loop**: deciso di usare il ralph-loop per migliorare lo sviluppo di task lunghi e la gestione del contesto — permette di iterare sullo stesso prompt vedendo il lavoro precedente nei file e nella git history
- **Agenti specializzati**: deciso di usare un set di agenti specializzati (debugger, feature-builder, code-reviewer per BE e FE) per risparmiare context window e essere molto specifici nei piccoli task assegnati
- **Pro Workflow plugin**: deciso di usare il plugin Pro Workflow per non dover ripetere ogni volta le correzioni alle allucinazioni dell'LLM e ai problemi derivanti dal context rot — le correzioni vengono salvate in un database SQLite e applicate automaticamente nelle sessioni successive
- **Design system Datapizza**: estratta la palette colori completa dal sito datapizza.tech — colore primario azure-600 (#1b64f5), font heading Oddval SemiBold, body Poppins, tema solo light. Aggiornati tutti e 3 gli agenti FE (feature-builder, code-reviewer, debugger) con la palette completa, i token semantici, le regole di layout e tipografia
- **SQLite come database**: aggiornati tutti e 3 gli agenti BE per usare SQLite invece di PostgreSQL. Rimossi riferimenti a JSONB, ARRAY, UUID PostgreSQL e sostituiti con pattern compatibili SQLite (TEXT per JSON, String(36) per UUID). Scelta fatta per comodita' e zero costi nella fase iniziale
- **Scaffolding completato**: creato monorepo con pnpm workspaces + Turborepo. FE: Next.js 16.0.11, React 19, Tailwind v4, next-intl con solo locale italiano. BE: FastAPI + SQLAlchemy + SQLite con 10 job finti nel seed. Porte: FE 3003, BE 8003
- **Homepage replicata**: ispirata a datapizza.tech/it con hero section, stats (150+ offerte, 100+ aziende, 50k+ developer), sezione servizi (Craft Your Developer, Mercato del Lavoro, AI Reskilling coming soon), community social stats, CTA finale
- **Pagina Craft Your Developer**: creata landing page B2B completa con: hero, sezione problema del recruiting tech, 4 benefit (formazione mirata, costi ridotti, qualita' garantita, time-to-hire ridotto), 4 step del processo (esplora profili, progetta percorso, formazione guidata, assumi), confronto hiring tradizionale vs CYD, CTA finale
- **Mercato del Lavoro**: pagina jobs con filtri per work_mode (remoto/ibrido/in sede), card con titolo, azienda, location, badge work_mode, salary range, tags tech, descrizione, paginazione. Dati dal BE via fetch API
- **Traduzioni solo italiano**: configurato next-intl con `locales: ['it']`, tutti i testi in `messages/it.json`. Aggiornati agenti FE con questa informazione
- **Monorepo + Turborepo**: deciso di procedere con un approccio monorepo perche' e' lo standard de facto per progetti grandi al momento. Turborepo e' stato scelto perche' quando si builda con Vercel aiuta ad automatizzare il workflow di CD/CI e riduce le build non necessarie
- **Cleanup e code review completa**: eseguita una pulizia completa di tutte le pagine. Rimossa la newsletter dal footer. Aggiunti link reali (termini, privacy, cookie da jobs.datapizza.tech). Corretti tutti i link social (Spotify URL fixato). Aggiunto cursor-pointer su tutti gli elementi interattivi come da standard
- **Jobs Market migliorato**: redesign completo delle card con emoji badge colorati (salario giallo, esperienza azure, work_mode verde, location neutro, welfare rosso), tech tags con priorita' verde, layout 2 colonne, dialog dettaglio job con chiusura su Escape e click esterno
- **Arricchimento dati job**: aggiunti campi experience_years, smart_working, welfare, language al modello DB, schema Pydantic e API. Seed aggiornato con dati realistici per tutti i 10 job
- **Code review FE+BE**: eseguite code review complete con agenti specializzati. Fixati: API URL hardcoded -> env variable, error handling API response, accessibilita' dialog (role="dialog", aria-modal, aria-labelledby), keyboard accessibility su JobCard (tabIndex, role="button", onKeyDown), cursor-pointer mancante su hamburger menu, bottone Candidati collegato ad apply_url, bottone Contattaci CYD collegato a datapizza.tech
- **Autenticazione utente**: implementato sistema auth completo con JWT + bcrypt. Modello User con campi profilo (skills, experience, location, availability_status, reskilling_status, adopted_by_company) pensato per supportare sia il flusso candidato che il futuro flusso CYD B2B. Token JWT con scadenza 24h, secret configurabile via env JWT_SECRET
- **Modello Application**: creato sistema candidature con UniqueConstraint su (user_id, job_id) per prevenire duplicati. Status a 4 valori (proposta/da_completare/attiva/archiviata) con status_detail per info aggiuntive e campi recruiter per tracciare il contatto aziendale
- **Pagine auth FE**: login e signup con form semplici, validazione client-side (password match, lunghezza minima), redirect automatico a /it/jobs dopo successo. AuthContext con React Context API, token in localStorage, validazione on mount via GET /auth/me
- **Navbar aggiornata**: aggiunta sezione auth (desktop: avatar iniziale + link candidature + bottone esci; mobile: stessa logica nel menu hamburger). "Accedi" e "Registrati" quando non loggato. "Le mie candidature" nel dropdown Talents quando loggato
- **Pagina candidature**: replicata UI simile a jobs.datapizza.tech/applications con hero, 4 tab di stato con badge conteggio, card candidatura con info job (salary, experience, work_mode), tech tags, dettagli recruiter e data. Empty state per tab vuoti
- **Bottone Candidati nel job dialog**: integrato con auth — se loggato fa POST /applications, se non loggato redirect a login. Gestione stati success/duplicate/loading. Se il job ha apply_url usa il link esterno come fallback
- **Seed ampliato**: 10 profili developer italiani realistici (nomi, ruoli, skill, citta' diverse) + 6 candidature di esempio distribuite su diversi status. Password hash per tutti "password123" per dev
- **Code review iterativa con Ralph Loop**: eseguiti 2 round completi di code review BE+FE con agenti specializzati + 17 test Playwright E2E. Fixati tutti i BLOCKER e CRITICAL (JWT secret env check, N+1 query, email validation, token expiry check client-side, typed API responses). Secondo round di review ha trovato e fixato: .env JWT_SECRET naming mismatch, get_application JOIN, safe_parse_json_list type validation, errori hardcoded in login/signup, useCallback su login/signup/logout, body scroll lock nel dialog, shared utility per formatSalary/formatDate/workModeLabel, i18n per stringhe nel dialog e paginazione
- **Deduplicazione utility**: estratte funzioni condivise in moduli dedicati sia BE (api/utils.py con safe_parse_json_list) che FE (lib/job-utils.ts con formatSalary, formatDate, workModeLabel). Eliminata duplicazione tra jobs.py, applications.py, auth.py lato BE e tra jobs/page.tsx e candidature/page.tsx lato FE
- **Migrazione a NextAuth v5**: rimosso il sistema auth custom (AuthContext.tsx con JWT in localStorage, client-side token expiry check) e sostituito con next-auth@5.0.0-beta.30. Credentials provider che chiama il backend POST /auth/login + GET /auth/me per ottenere token e profilo utente. Session in httpOnly cookie (piu' sicuro di localStorage). Backend FastAPI rimasto invariato — NextAuth lo wrappa lato FE. Creati: auth.ts (config NextAuth), use-auth.ts (hook custom), route handler [...nextauth], type declarations, Providers.tsx (SessionProvider wrapper). Login usa signIn('credentials'), signup usa flusso a due step (POST signup diretto + signIn per creare sessione). Aggiornate tutte le pagine (login, signup, navbar, candidature, jobs) per usare il nuovo hook useAuth da lib/auth/use-auth
- **Backend News e Corsi**: aggiunti modelli News e Course in models.py seguendo esattamente i pattern esistenti (String(36) UUID, tags_json TEXT, is_active Integer, timestamps UTC). Creati schema Pydantic (NewsResponse, CourseResponse con tags: list[str] tramite safe_parse_json_list) e route FastAPI (GET /news con filtro category AI/tech/careers, GET /news/{id} con 404; GET /courses con filtri category e level, GET /courses/{id} con 404). Ordinamento: news per published_at desc, corsi per created_at desc. Seed con 10 news realistiche (temi AI/tech/careers da HN e TLDR) e 10 corsi realistici (Coursera/Udemy con istruttori, rating, studenti). Route registrate in main.py su /api/v1. Tutti gli endpoint testati e funzionanti
- **Pagine FE News e Corsi**: create le pagine news/page.tsx e courses/page.tsx seguendo esattamente il pattern della pagina jobs (hero, filtri per categoria, griglia 2 colonne di card, dialog dettaglio, paginazione, escape per chiudere). News: filtri all/AI/tech/careers, card con icona Newspaper, badge colorato per categoria (AI=azure, tech=pastelgreen, careers=yellow), tags, summary, data pubblicazione con icona Calendar. Corsi: filtri all/AI/ML/frontend/backend/devops, card con icona GraduationCap, badge livello colorato (beginner=verde, intermediate=azure, advanced=rosso), durata, prezzo, rating con stella, tags. Dialog per entrambi con scroll lock, chiusura su Escape e click esterno, bottone CTA esterno ("Leggi l'articolo" / "Vai al Corso"). Aggiornata Navbar con link "News Tech" e "Corsi di Formazione" nel dropdown Talenti (desktop e mobile). Aggiunte tutte le traduzioni i18n in it.json. Riutilizzato formatDate da job-utils.ts. TypeScript check passato senza errori
- **Code review e fix completati**: eseguite code review BE+FE con agenti specializzati. BE: aggiunti indici composite su News (is_active+published_at, category) e Course (is_active+created_at, category, level) per query performance; fixato session leak in seed con try/finally; estratti helper \_to_news_response e \_to_course_response per eliminare duplicazione. FE: estratto TechTag in componente condiviso @/components/ui/TechTag.tsx (eliminata duplicazione tripla tra jobs, news, courses); spostato handler Escape dentro i dialog component invece che a livello pagina; aggiunto aria-pressed su filtri, aria-live="polite" su contenuto dinamico, aria-hidden su icone decorative Star. Rimosso import useRef inutilizzato da jobs/page.tsx
- **Footer aggiornato**: aggiunti link "News Tech" e "Corsi di Formazione" nella sezione Pagine del footer, allineando la navigazione footer con quella della navbar
- **GitHub Action per fetch notturno di contenuti**: creata una GitHub Action disabilitata (solo workflow_dispatch, cron commentato per le 01:00 AM UTC) che dimostra come popolare automaticamente il database con news e corsi ogni notte. Scelta architetturale chiave: invece di scrivere un classico scraper Python (fragile, si rompe al minimo cambiamento della struttura HTML), si usa **Claude Code come agente** (`npx @anthropic-ai/claude-code --print`), lo stesso pattern usato nel progetto next-monorepo per il daily changelog. L'agente legge le istruzioni da `.claude/agents/datapizza-tools-content-fetcher.md`, fetcha contenuti da 4 fonti (HN API, TLDR Tech, Coursera, Udemy) e li inserisce nel DB usando lo script CLI `apps/api/api/scrapers/insert_content.py`. Lo script CLI riceve JSON da stdin, deduplicata per source_url/url e title+source/provider, e inserisce usando gli stessi modelli SQLAlchemy. Testato localmente: inserimento, deduplicazione e cleanup funzionano correttamente
- **Profile feature backend**: implementato il backend completo per la gestione del profilo utente. Aggiunti 2 nuovi modelli SQLAlchemy (Experience, Education) con indici su user_id per performance delle query. Aggiunti 3 nuovi campi URL (linkedin_url, github_url, portfolio_url) al modello User esistente. Creati 3 nuovi file di schema Pydantic (profile.py, experience.py, education.py) per validazione input/output con conversione automatica is_current Integer/bool tra DB e API. Creato routes/profile.py con 8 endpoint CRUD completi: GET/PATCH profilo (con gestione speciale skills JSON), POST/PATCH/DELETE esperienze lavorative, POST/PATCH/DELETE formazione. Ogni endpoint verifica che la risorsa appartenga all'utente autenticato. Aggiornato anche UserResponse in schemas/auth.py e _user_to_response in routes/auth.py per includere i nuovi campi URL. Seed ampliato con 13 esperienze lavorative e 8 percorsi formativi realistici per i primi 5 utenti italiani. La scelta di usare hard delete (non soft delete) per esperienze e formazione e' stata fatta perche' sono dati personali dell'utente, non risorse condivise — pattern diverso rispetto ai job che hanno is_active per soft delete
- **Pagina Profilo FE**: creata pagina /it/profilo completa come single-file page (pattern progetto). Struttura: ProfileHeader con avatar iniziale grande, nome, ruolo, location, badge disponibilita' colorato (verde/azure/giallo), link social (LinkedIn, GitHub, Portfolio), bottone "Modifica Profilo". ProfileEditModal con form completo per tutti i campi profilo (nome, telefono, bio, location, ruolo, livello, anni esperienza, disponibilita', URL social) con chiusura su Escape e click esterno + scroll lock. SkillsSection con pill tag editabili inline (aggiungi con input + Enter, rimuovi con X su ogni pill), salvataggio immediato via PATCH. ExperienceSection e EducationSection con CRUD completo (form inline per add/edit, conferma per delete, loading states con Loader2). Aggiornata Navbar con link "Il mio Profilo" in 3 posizioni: desktop right-side (prima di candidature), dropdown Talenti, menu mobile. Aggiunte tutte le traduzioni i18n (60+ chiavi) incluse opzioni per availability, experience_levels, employment_types, degree_types. TypeScript check passato senza errori
- **Code review FE pagina Profilo**: eseguita code review completa con agente FE code-reviewer. Trovati e fixati 5 CRITICAL: (1) hook ordering violato — useAuth prima di useRouter nel main component, corretto seguendo il 9-step pattern; (2) type safety — handleChange nel ProfileEditModal usava `field: string` invece di `keyof typeof formData`; (3) silent error swallowing — ExperienceSection e EducationSection avevano catch block vuoti senza feedback utente, aggiunti stato `feedback` e messaggio errore visibile; (4) non-null assertions `accessToken!` rischiose su 3 componenti, aggiunto guard `!accessToken` nell'early return e rimossi gli `!`; (5) stringa hardcoded "es. 3-5 anni" nel placeholder, estratta in i18n come `experienceYearsPlaceholder`. Navbar e traduzioni it.json revisionate senza problemi. TypeScript check passato senza errori dopo tutti i fix
- **Test E2E Playwright pagina Profilo**: creata suite di 6 test Playwright in `apps/web/tests/profile.spec.ts` con config dedicata in `tests/playwright.config.ts` (la config principale usa testDir `./e2e`). I test coprono: (1) redirect a login se non autenticato; (2) visualizzazione dati profilo (nome, ruolo, location, bio, 5 skill, esperienze, formazione); (3) modifica profilo via modal (cambio bio, salvataggio, verifica, ripristino); (4) gestione skill (toggle edit mode, aggiunta via input+Enter, rimozione via X); (5) aggiunta esperienza lavorativa (form inline, compilazione campi, submit, verifica, cleanup con delete); (6) aggiunta formazione (form inline, compilazione, submit, verifica, cleanup). Ogni test che aggiunge dati ripulisce dopo se stesso per idempotenza. Login gestito con helper riutilizzabile che naviga su /it/login, compila credenziali e attende redirect a /it/jobs. Trovato e fixato un problema di strict mode Playwright su `getByText('Frontend Developer')` che matchava 4 elementi — risolto con `{ exact: true }`. Tutti i 6 test passano stabilmente su 2 run consecutivi (~14s totali)
- **Test suite backend con pytest**: creata suite completa di 112 test unitari per l'API FastAPI seguendo il pattern 3bee-helpdesk (conftest.py con fixture condivise + tests/unit/test_*.py). Struttura: `tests/conftest.py` con 9 fixture (mock_db, mock_user, mock_job, mock_news, mock_course, mock_experience, mock_education, mock_application), `tests/unit/` con 9 file di test. Copertura completa: (1) test_auth.py — hashing bcrypt, token JWT (creazione, claims sub/exp, scadenza), get_current_user (token valido/invalido/scaduto/senza sub/utente inesistente); (2) test_auth_routes.py — signup (creazione utente, email duplicata 409, validazione password corta, email invalida), login (credenziali valide, password sbagliata, email inesistente), get_me; (3) test_jobs_routes.py — list_jobs (ritorno items, lista vuota, filtro work_mode, paginazione con offset corretto, parsing tags_json, gestione tags null); (4) test_news_routes.py — list/get news con filtro category e 404; (5) test_courses_routes.py — list/get courses con filtri category+level (singoli e combinati) e 404; (6) test_profile_routes.py — helper functions, get/update profile (conversione skills JSON, aggiornamento solo campi forniti), CRUD esperienze e formazione (creazione, aggiornamento, is_current che pulisce date fine, cancellazione, ownership check 404); (7) test_applications_routes.py — creazione candidatura (successo, job non trovato 404, duplicato 409), lista con conteggi status, get per id e 404; (8) test_schemas.py — validazione Pydantic per JobResponse, ProfileUpdate, ExperienceCreate, EducationCreate (campi required, min/max length, range numerici); (9) test_utils.py — safe_parse_json_list con tutti i casi limite (JSON valido, invalido, non-lista, tipi misti, None, stringa vuota). Scelta di usare solo mock (unittest.mock.MagicMock) senza database reale per velocita' e isolamento. Aggiunto pytest e pytest-asyncio a requirements.txt. Tutti i 112 test passano in ~3 secondi
- **Riorganizzazione test E2E**: spostato `profile.spec.ts` dalla cartella `tests/` alla cartella `e2e/` dove vivono tutti gli altri test Playwright. Rimosso il `BASE_URL` hardcoded sostituendolo con path relativi (usa `baseURL` dalla config principale `playwright.config.ts`). Rimossa la cartella `tests/` e la config `playwright.config.ts` duplicata. Tutti i 6 test passano dalla nuova posizione
- **Branch rinominato**: da `feature/replicate-the-current-datapizza-main-pages` a `feature/replicate-the-current-datapizza-main-pages-plus-initial-new-features-batch` per riflettere meglio il contenuto del branch che include non solo la replica delle pagine esistenti ma anche nuove feature (profilo, news, corsi, auth, candidature)
- **Aggiornamento agenti reviewer**: aggiornati sia `datapizza-tools-be-code-reviewer.md` che `datapizza-tools-fe-code-reviewer.md` con requisiti obbligatori di test coverage. BE reviewer: ogni endpoint/schema/utility deve avere test unitari pytest con copertura happy path, 404, 401, 422 e data isolation — la test review e' stata promossa da Medium a Critical. FE reviewer: ogni pagina nuova/modificata deve avere test Playwright E2E con smoke test, auth guard, data display e interazioni utente. Entrambi i reviewer ora verificano nella self-verification checklist che i test esistano e siano passanti, creandoli se mancanti
