# Thought Process

- Configurazione iniziale del progetto: creati agenti `datapizza-tools-*` indicando le regole di coding, stili e best practice sia per il fe che per il be
- Aggiornato `CLAUDE.md` con le istruzioni da eseguire ad ogni prompt, commit e per migliorare la gestione del contesto
- Aggiunte istruzioni post-prompt in `CLAUDE.md`: aggiornamento automatico di README.md, THOUGHT_PROCESS.md e agenti dopo ogni prompt completato
- **Visione del progetto**: il mercato del lavoro tech nei prossimi 6-12 mesi sara' stravolto dall'introduzione dei workflow agentici. Si stima che il 60-70% dei lavori digitali saranno impattati. Datapizza deve posizionarsi come punto di riferimento per aiutare gli sviluppatori a navigare questo cambiamento, acquisire nuove competenze e trovare nuovi ruoli
- **Scelte tecniche**: SQLite locale per comodita' e zero costi di hosting nella fase iniziale. FastAPI per lo sviluppo rapido e la possibilita' di deploy su AWS o Vercel (versione Python scelta per compatibilita' con altri progetti esistenti). Next.js con App Router come standard per tutti i nuovi progetti
- **Funzionalita' core pianificate**: (1) replicare e migliorare la job board esistente di Datapizza, (2) profili candidato con tech stack, notifiche giornaliere su corsi AI e progetti di reskilling (newsletter o bot Telegram), (3) "Craft Your Developer" - prodotto B2B a pagamento dove le aziende possono progettare percorsi formativi per candidati specifici e assumerli dopo il reskilling
- **Flusso "Craft Your Developer"**: le aziende navigano i profili dei candidati in cerca di lavoro, selezionano un candidato, progettano un training program personalizzato con corsi e competenze AI necessarie, e poi lo assumono. Questo flusso sara' probabilmente a pagamento per l'azienda
- **Ralph Loop**: deciso di usare il ralph-loop per migliorare lo sviluppo di task lunghi e la gestione del contesto — permette di iterare sullo stesso prompt vedendo il lavoro precedente nei file e nella git history
- **Agenti specializzati**: deciso di usare un set di agenti specializzati (debugger, feature-builder, code-reviewer per BE e FE) per risparmiare context window e essere molto specifici nei piccoli task assegnati
- **Pro Workflow plugin**: deciso di usare il plugin Pro Workflow per non dover ripetere ogni volta le correzioni alle allucinazioni dell'LLM e ai problemi derivanti dal context rot — le correzioni vengono salvate in un database SQLite e applicate automaticamente nelle sessioni successive
- **Design system Datapizza**: estratta la palette colori completa dal sito datapizza.tech — colore primario azure-600 (#1b64f5), font heading Oddval SemiBold, body Poppins, tema solo light. Aggiornati tutti e 3 gli agenti FE (feature-builder, code-reviewer, debugger) con la palette completa, i token semantici, le regole di layout e tipografia
- **SQLite come database**: aggiornati tutti e 3 gli agenti BE per usare SQLite invece di PostgreSQL. Rimossi riferimenti a JSONB, ARRAY, UUID PostgreSQL e sostituiti con pattern compatibili SQLite (TEXT per JSON, String(36) per UUID). Scelta fatta per comodita' e zero costi nella fase iniziale
- **Scaffolding completato**: creato monorepo con pnpm workspaces + Turborepo. FE: Next.js 16.0.11, React 19, Tailwind v4, next-intl con solo locale italiano. BE: FastAPI + SQLAlchemy + SQLite con 10 job finti nel seed. Porte: FE 3003, BE 8003
- **Homepage replicata**: ispirata a datapizza.tech/it con hero section, stats (150+ offerte, 100+ aziende, 50k+ developer), sezione servizi (Craft Your Developer, Mercato del Lavoro, AI Reskilling coming soon), community social stats, CTA finale
- **Pagina Craft Your Developer**: creata landing page B2B completa con: hero, sezione problema del recruiting tech, 4 benefit (formazione mirata, costi ridotti, qualita' garantita, time-to-hire ridotto), 4 step del processo (esplora profili, progetta percorso, formazione guidata, assumi), confronto hiring tradizionale vs CYD, CTA finale
- **Mercato del Lavoro**: pagina jobs con filtri per work_mode (remoto/ibrido/in sede), card con titolo, azienda, location, badge work_mode, salary range, tags tech, descrizione, paginazione. Dati dal BE via fetch API
- **Traduzioni solo italiano**: configurato next-intl con `locales: ['it']`, tutti i testi in `messages/it.json`. Aggiornati agenti FE con questa informazione
- **Monorepo + Turborepo**: deciso di procedere con un approccio monorepo perche' e' lo standard de facto per progetti grandi al momento. Turborepo e' stato scelto perche' quando si builda con Vercel aiuta ad automatizzare il workflow di CD/CI e riduce le build non necessarie
- **Cleanup e code review completa**: eseguita una pulizia completa di tutte le pagine. Rimossa la newsletter dal footer. Aggiunti link reali (termini, privacy, cookie da jobs.datapizza.tech). Corretti tutti i link social (Spotify URL fixato). Aggiunto cursor-pointer su tutti gli elementi interattivi come da standard
- **Jobs Market migliorato**: redesign completo delle card con emoji badge colorati (salario giallo, esperienza azure, work_mode verde, location neutro, welfare rosso), tech tags con priorita' verde, layout 2 colonne, dialog dettaglio job con chiusura su Escape e click esterno
- **Arricchimento dati job**: aggiunti campi experience_years, smart_working, welfare, language al modello DB, schema Pydantic e API. Seed aggiornato con dati realistici per tutti i 10 job
- **Code review FE+BE**: eseguite code review complete con agenti specializzati. Fixati: API URL hardcoded -> env variable, error handling API response, accessibilita' dialog (role="dialog", aria-modal, aria-labelledby), keyboard accessibility su JobCard (tabIndex, role="button", onKeyDown), cursor-pointer mancante su hamburger menu, bottone Candidati collegato ad apply_url, bottone Contattaci CYD collegato a datapizza.tech
- **Autenticazione utente**: implementato sistema auth completo con JWT + bcrypt. Modello User con campi profilo (skills, experience, location, availability_status, reskilling_status, adopted_by_company) pensato per supportare sia il flusso candidato che il futuro flusso CYD B2B. Token JWT con scadenza 24h, secret configurabile via env JWT_SECRET
- **Modello Application**: creato sistema candidature con UniqueConstraint su (user_id, job_id) per prevenire duplicati. Status a 4 valori (proposta/da_completare/attiva/archiviata) con status_detail per info aggiuntive e campi recruiter per tracciare il contatto aziendale
- **Pagine auth FE**: login e signup con form semplici, validazione client-side (password match, lunghezza minima), redirect automatico a /it/jobs dopo successo. AuthContext con React Context API, token in localStorage, validazione on mount via GET /auth/me
- **Navbar aggiornata**: aggiunta sezione auth (desktop: avatar iniziale + link candidature + bottone esci; mobile: stessa logica nel menu hamburger). "Accedi" e "Registrati" quando non loggato. "Le mie candidature" nel dropdown Talents quando loggato
- **Pagina candidature**: replicata UI simile a jobs.datapizza.tech/applications con hero, 4 tab di stato con badge conteggio, card candidatura con info job (salary, experience, work_mode), tech tags, dettagli recruiter e data. Empty state per tab vuoti
- **Bottone Candidati nel job dialog**: integrato con auth — se loggato fa POST /applications, se non loggato redirect a login. Gestione stati success/duplicate/loading. Se il job ha apply_url usa il link esterno come fallback
- **Seed ampliato**: 10 profili developer italiani realistici (nomi, ruoli, skill, citta' diverse) + 6 candidature di esempio distribuite su diversi status. Password hash per tutti "password123" per dev
- **Code review iterativa con Ralph Loop**: eseguiti 2 round completi di code review BE+FE con agenti specializzati + 17 test Playwright E2E. Fixati tutti i BLOCKER e CRITICAL (JWT secret env check, N+1 query, email validation, token expiry check client-side, typed API responses). Secondo round di review ha trovato e fixato: .env JWT_SECRET naming mismatch, get_application JOIN, safe_parse_json_list type validation, errori hardcoded in login/signup, useCallback su login/signup/logout, body scroll lock nel dialog, shared utility per formatSalary/formatDate/workModeLabel, i18n per stringhe nel dialog e paginazione
- **Deduplicazione utility**: estratte funzioni condivise in moduli dedicati sia BE (api/utils.py con safe_parse_json_list) che FE (lib/job-utils.ts con formatSalary, formatDate, workModeLabel). Eliminata duplicazione tra jobs.py, applications.py, auth.py lato BE e tra jobs/page.tsx e candidature/page.tsx lato FE
- **Migrazione a NextAuth v5**: rimosso il sistema auth custom (AuthContext.tsx con JWT in localStorage, client-side token expiry check) e sostituito con next-auth@5.0.0-beta.30. Credentials provider che chiama il backend POST /auth/login + GET /auth/me per ottenere token e profilo utente. Session in httpOnly cookie (piu' sicuro di localStorage). Backend FastAPI rimasto invariato — NextAuth lo wrappa lato FE. Creati: auth.ts (config NextAuth), use-auth.ts (hook custom), route handler [...nextauth], type declarations, Providers.tsx (SessionProvider wrapper). Login usa signIn('credentials'), signup usa flusso a due step (POST signup diretto + signIn per creare sessione). Aggiornate tutte le pagine (login, signup, navbar, candidature, jobs) per usare il nuovo hook useAuth da lib/auth/use-auth
- **Backend News e Corsi**: aggiunti modelli News e Course in models.py seguendo esattamente i pattern esistenti (String(36) UUID, tags_json TEXT, is_active Integer, timestamps UTC). Creati schema Pydantic (NewsResponse, CourseResponse con tags: list[str] tramite safe_parse_json_list) e route FastAPI (GET /news con filtro category AI/tech/careers, GET /news/{id} con 404; GET /courses con filtri category e level, GET /courses/{id} con 404). Ordinamento: news per published_at desc, corsi per created_at desc. Seed con 10 news realistiche (temi AI/tech/careers da HN e TLDR) e 10 corsi realistici (Coursera/Udemy con istruttori, rating, studenti). Route registrate in main.py su /api/v1. Tutti gli endpoint testati e funzionanti
- **Pagine FE News e Corsi**: create le pagine news/page.tsx e courses/page.tsx seguendo esattamente il pattern della pagina jobs (hero, filtri per categoria, griglia 2 colonne di card, dialog dettaglio, paginazione, escape per chiudere). News: filtri all/AI/tech/careers, card con icona Newspaper, badge colorato per categoria (AI=azure, tech=pastelgreen, careers=yellow), tags, summary, data pubblicazione con icona Calendar. Corsi: filtri all/AI/ML/frontend/backend/devops, card con icona GraduationCap, badge livello colorato (beginner=verde, intermediate=azure, advanced=rosso), durata, prezzo, rating con stella, tags. Dialog per entrambi con scroll lock, chiusura su Escape e click esterno, bottone CTA esterno ("Leggi l'articolo" / "Vai al Corso"). Aggiornata Navbar con link "News Tech" e "Corsi di Formazione" nel dropdown Talenti (desktop e mobile). Aggiunte tutte le traduzioni i18n in it.json. Riutilizzato formatDate da job-utils.ts. TypeScript check passato senza errori
- **Code review e fix completati**: eseguite code review BE+FE con agenti specializzati. BE: aggiunti indici composite su News (is_active+published_at, category) e Course (is_active+created_at, category, level) per query performance; fixato session leak in seed con try/finally; estratti helper \_to_news_response e \_to_course_response per eliminare duplicazione. FE: estratto TechTag in componente condiviso @/components/ui/TechTag.tsx (eliminata duplicazione tripla tra jobs, news, courses); spostato handler Escape dentro i dialog component invece che a livello pagina; aggiunto aria-pressed su filtri, aria-live="polite" su contenuto dinamico, aria-hidden su icone decorative Star. Rimosso import useRef inutilizzato da jobs/page.tsx
- **Footer aggiornato**: aggiunti link "News Tech" e "Corsi di Formazione" nella sezione Pagine del footer, allineando la navigazione footer con quella della navbar
- **GitHub Action per fetch notturno di contenuti**: creata una GitHub Action disabilitata (solo workflow_dispatch, cron commentato per le 01:00 AM UTC) che dimostra come popolare automaticamente il database con news e corsi ogni notte. Scelta architetturale chiave: invece di scrivere un classico scraper Python (fragile, si rompe al minimo cambiamento della struttura HTML), si usa **Claude Code come agente** (`npx @anthropic-ai/claude-code --print`), lo stesso pattern usato nel progetto next-monorepo per il daily changelog. L'agente legge le istruzioni da `.claude/agents/datapizza-tools-content-fetcher.md`, fetcha contenuti da 4 fonti (HN API, TLDR Tech, Coursera, Udemy) e li inserisce nel DB usando lo script CLI `apps/api/api/scrapers/insert_content.py`. Lo script CLI riceve JSON da stdin, deduplicata per source_url/url e title+source/provider, e inserisce usando gli stessi modelli SQLAlchemy. Testato localmente: inserimento, deduplicazione e cleanup funzionano correttamente
- **Profile feature backend**: implementato il backend completo per la gestione del profilo utente. Aggiunti 2 nuovi modelli SQLAlchemy (Experience, Education) con indici su user_id per performance delle query. Aggiunti 3 nuovi campi URL (linkedin_url, github_url, portfolio_url) al modello User esistente. Creati 3 nuovi file di schema Pydantic (profile.py, experience.py, education.py) per validazione input/output con conversione automatica is_current Integer/bool tra DB e API. Creato routes/profile.py con 8 endpoint CRUD completi: GET/PATCH profilo (con gestione speciale skills JSON), POST/PATCH/DELETE esperienze lavorative, POST/PATCH/DELETE formazione. Ogni endpoint verifica che la risorsa appartenga all'utente autenticato. Aggiornato anche UserResponse in schemas/auth.py e \_user_to_response in routes/auth.py per includere i nuovi campi URL. Seed ampliato con 13 esperienze lavorative e 8 percorsi formativi realistici per i primi 5 utenti italiani. La scelta di usare hard delete (non soft delete) per esperienze e formazione e' stata fatta perche' sono dati personali dell'utente, non risorse condivise — pattern diverso rispetto ai job che hanno is_active per soft delete
- **Pagina Profilo FE**: creata pagina /it/profilo completa come single-file page (pattern progetto). Struttura: ProfileHeader con avatar iniziale grande, nome, ruolo, location, badge disponibilita' colorato (verde/azure/giallo), link social (LinkedIn, GitHub, Portfolio), bottone "Modifica Profilo". ProfileEditModal con form completo per tutti i campi profilo (nome, telefono, bio, location, ruolo, livello, anni esperienza, disponibilita', URL social) con chiusura su Escape e click esterno + scroll lock. SkillsSection con pill tag editabili inline (aggiungi con input + Enter, rimuovi con X su ogni pill), salvataggio immediato via PATCH. ExperienceSection e EducationSection con CRUD completo (form inline per add/edit, conferma per delete, loading states con Loader2). Aggiornata Navbar con link "Il mio Profilo" in 3 posizioni: desktop right-side (prima di candidature), dropdown Talenti, menu mobile. Aggiunte tutte le traduzioni i18n (60+ chiavi) incluse opzioni per availability, experience_levels, employment_types, degree_types. TypeScript check passato senza errori
- **Code review FE pagina Profilo**: eseguita code review completa con agente FE code-reviewer. Trovati e fixati 5 CRITICAL: (1) hook ordering violato — useAuth prima di useRouter nel main component, corretto seguendo il 9-step pattern; (2) type safety — handleChange nel ProfileEditModal usava `field: string` invece di `keyof typeof formData`; (3) silent error swallowing — ExperienceSection e EducationSection avevano catch block vuoti senza feedback utente, aggiunti stato `feedback` e messaggio errore visibile; (4) non-null assertions `accessToken!` rischiose su 3 componenti, aggiunto guard `!accessToken` nell'early return e rimossi gli `!`; (5) stringa hardcoded "es. 3-5 anni" nel placeholder, estratta in i18n come `experienceYearsPlaceholder`. Navbar e traduzioni it.json revisionate senza problemi. TypeScript check passato senza errori dopo tutti i fix
- **Test E2E Playwright pagina Profilo**: creata suite di 6 test Playwright in `apps/web/tests/profile.spec.ts` con config dedicata in `tests/playwright.config.ts` (la config principale usa testDir `./e2e`). I test coprono: (1) redirect a login se non autenticato; (2) visualizzazione dati profilo (nome, ruolo, location, bio, 5 skill, esperienze, formazione); (3) modifica profilo via modal (cambio bio, salvataggio, verifica, ripristino); (4) gestione skill (toggle edit mode, aggiunta via input+Enter, rimozione via X); (5) aggiunta esperienza lavorativa (form inline, compilazione campi, submit, verifica, cleanup con delete); (6) aggiunta formazione (form inline, compilazione, submit, verifica, cleanup). Ogni test che aggiunge dati ripulisce dopo se stesso per idempotenza. Login gestito con helper riutilizzabile che naviga su /it/login, compila credenziali e attende redirect a /it/jobs. Trovato e fixato un problema di strict mode Playwright su `getByText('Frontend Developer')` che matchava 4 elementi — risolto con `{ exact: true }`. Tutti i 6 test passano stabilmente su 2 run consecutivi (~14s totali)
- **Test suite backend con pytest**: creata suite completa di 112 test unitari per l'API FastAPI (conftest.py con fixture condivise + tests/unit/test\_\*.py). Struttura: `tests/conftest.py` con 9 fixture (mock_db, mock_user, mock_job, mock_news, mock_course, mock_experience, mock_education, mock_application), `tests/unit/` con 9 file di test. Copertura completa: (1) test_auth.py — hashing bcrypt, token JWT (creazione, claims sub/exp, scadenza), get_current_user (token valido/invalido/scaduto/senza sub/utente inesistente); (2) test_auth_routes.py — signup (creazione utente, email duplicata 409, validazione password corta, email invalida), login (credenziali valide, password sbagliata, email inesistente), get_me; (3) test_jobs_routes.py — list_jobs (ritorno items, lista vuota, filtro work_mode, paginazione con offset corretto, parsing tags_json, gestione tags null); (4) test_news_routes.py — list/get news con filtro category e 404; (5) test_courses_routes.py — list/get courses con filtri category+level (singoli e combinati) e 404; (6) test_profile_routes.py — helper functions, get/update profile (conversione skills JSON, aggiornamento solo campi forniti), CRUD esperienze e formazione (creazione, aggiornamento, is_current che pulisce date fine, cancellazione, ownership check 404); (7) test_applications_routes.py — creazione candidatura (successo, job non trovato 404, duplicato 409), lista con conteggi status, get per id e 404; (8) test_schemas.py — validazione Pydantic per JobResponse, ProfileUpdate, ExperienceCreate, EducationCreate (campi required, min/max length, range numerici); (9) test_utils.py — safe_parse_json_list con tutti i casi limite (JSON valido, invalido, non-lista, tipi misti, None, stringa vuota). Scelta di usare solo mock (unittest.mock.MagicMock) senza database reale per velocita' e isolamento. Aggiunto pytest e pytest-asyncio a requirements.txt. Tutti i 112 test passano in ~3 secondi
- **Riorganizzazione test E2E**: spostato `profile.spec.ts` dalla cartella `tests/` alla cartella `e2e/` dove vivono tutti gli altri test Playwright. Rimosso il `BASE_URL` hardcoded sostituendolo con path relativi (usa `baseURL` dalla config principale `playwright.config.ts`). Rimossa la cartella `tests/` e la config `playwright.config.ts` duplicata. Tutti i 6 test passano dalla nuova posizione
- **Branch rinominato**: da `feature/replicate-the-current-datapizza-main-pages` a `feature/replicate-the-current-datapizza-main-pages-plus-initial-new-features-batch` per riflettere meglio il contenuto del branch che include non solo la replica delle pagine esistenti ma anche nuove feature (profilo, news, corsi, auth, candidature)
- **Aggiornamento agenti reviewer**: aggiornati sia `datapizza-tools-be-code-reviewer.md` che `datapizza-tools-fe-code-reviewer.md` con requisiti obbligatori di test coverage. BE reviewer: ogni endpoint/schema/utility deve avere test unitari pytest con copertura happy path, 404, 401, 422 e data isolation — la test review e' stata promossa da Medium a Critical. FE reviewer: ogni pagina nuova/modificata deve avere test Playwright E2E con smoke test, auth guard, data display e interazioni utente. Entrambi i reviewer ora verificano nella self-verification checklist che i test esistano e siano passanti, creandoli se mancanti
- **Public Developer Profiles (Browse Talents) backend**: implementata la feature completa per la navigazione pubblica dei profili developer. Aggiunto campo `is_public` (Integer, default 0) al modello User con indice composito `ix_users_is_public_is_active` per performance delle query. Creati 2 nuovi schema Pydantic in `schemas/talent.py`: `TalentCardResponse` (card riassuntiva senza email/phone/password) e `TalentDetailResponse` (profilo completo con esperienze e formazione, ma senza dati sensibili). Creato `routes/talents.py` con 2 endpoint pubblici (NO auth required): `GET /talents` con search (full*name, current_role, skills_json via or* ILIKE), filtri (skills comma-separated con OR logic, availability, experience_level, location ILIKE) e paginazione; `GET /talents/{id}` con dettaglio completo incluse esperienze (ordinate per start_year desc) e formazione. Privacy: i profili privati (is_public=0) e inesistenti ritornano entrambi 404 per prevenire enumerazione. Aggiornato `ProfileUpdate` e `ProfileResponse` per includere `is_public` con conversione bool/Integer. Seed aggiornato con 6 utenti pubblici e 4 privati, piu' URL social per Marco Rossi, Giulia Bianchi e Luca Ferrari. Test suite ampliata da 112 a 134 test: 20 nuovi test per talents (13 TestListTalents + 7 TestGetTalent) e 2 nuovi test per is_public nel profilo. Tutti i 134 test passano in ~3 secondi
- **Public Developer Profiles (Browse Talents) frontend**: implementato il frontend completo per il marketplace dei talenti pubblici. (1) Pagina lista `/it/talenti` con ricerca testuale, filtri per livello esperienza (Tutti/Junior/Mid/Senior) e disponibilita' (Tutti/Disponibile/Occupato/In formazione), griglia 2 colonne di TalentCard (avatar iniziale, nome, ruolo, location, badge livello+anni+disponibilita', skill pills con "+N" per overflow, bio troncata), paginazione — pattern visivo identico alla pagina jobs. (2) Pagina dettaglio `/it/talenti/[id]` come versione read-only del profilo: header con avatar, nome, ruolo, location, badge, link social; sezioni bio, skills, esperienze, formazione (stesso layout del profilo ma senza bottoni edit/delete); CTA finale "Interessato a questo talento?" con link a Craft Your Developer; gestione 404 con pagina dedicata. (3) Privacy toggle nella pagina profilo (`PrivacyToggleSection`): card con icona Eye, titolo, descrizione, toggle switch (verde=on, grigio=off), info box azure che spiega cosa significa essere pubblici; chiama PATCH /profile con is_public. (4) Sezione "Scopri i Talenti" nella pagina CYD tra "Come Funziona" e "Confronto". (5) Navbar aggiornata con link "Scopri i Talenti" nel dropdown Aziende (desktop e mobile). (6) Footer aggiornato con link nella sezione Pagine. (7) 70+ nuove chiavi i18n per talents, privacyToggle, e craftYourDeveloper.talents. Le pagine talenti sono pubbliche (nessun auth check). Email e telefono mai esposti. TypeScript check passato senza errori
- **Test E2E Playwright per Browse Talents e Privacy Toggle**: creata suite completa di 13 test Playwright in `apps/web/e2e/talents.spec.ts` per la feature Public Developer Profiles. I test coprono 4 gruppi: (1) **Talents List Page** (5 test, no auth): rendering pagina con talenti pubblici e verifica assenza utenti privati (6 card visibili, Andrea Conti non presente), ricerca per nome con debounce 350ms (Giulia visibile, Marco filtrato), filtro per livello esperienza Senior (Marco visibile, Luca filtrato), filtro per disponibilita' "Disponibile", empty state per ricerca senza risultati con messaggi corretti. (2) **Talent Detail Page** (5 test, no auth): navigazione lista->dettaglio con verifica sezioni (nome, ruolo, location, esperienza, formazione, TechFlow Italia), verifica privacy (email e telefono NON visibili), 404 per talento inesistente ("Talento non trovato"), link social LinkedIn e GitHub visibili (scoped a main per evitare conflitto col footer), CTA "Interessato a questo talento?" con link a Craft Your Developer. (3) **Profile Privacy Toggle** (2 test, auth required): visibilita' toggle (heading "Visibilita' Profilo" + role="switch"), toggle stato con verifica aria-checked cambia e ripristino stato originale per idempotenza. (4) **Navigation** (1 test): link "Scopri i Talenti" nella pagina CYD naviga correttamente a /it/talenti. Pattern seguiti: login helper riutilizzabile, locator scoped a getByRole('main') per evitare strict mode violations con elementi del footer, wait appropriati per debounce e API call, test idempotenti che ripristinano lo stato. Tutti i 36 test E2E (23 esistenti + 13 nuovi) passano stabilmente in ~14s per i soli talents e ~41s per l'intera suite
- **Company Accounts & Contact Flow (Backend)**: implementato il backend completo per il flusso aziendale "Craft Your Developer". (1) **Modello User esteso** con 5 nuovi campi (user_type talent/company, company_name, company_website, company_size, industry) e indice su user_type. (2) **2 nuovi modelli SQLAlchemy**: Proposal (company_id, talent_id, status con 5 stati draft/sent/accepted/rejected/completed, message, budget_range) e ProposalCourse (proposal_id, course_id, order, is_completed, completed_at con UniqueConstraint). (3) **Schema auth aggiornato** con campo user_type nel signup, model_validator per richiedere company_name quando user_type=company, e campi company in UserResponse. (4) **Schema profile aggiornato** con campi company in ProfileUpdate e ProfileResponse. (5) **Nuovi schema proposal**: ProposalCreate (talent_id, course_ids con min_length=1), ProposalUpdate (status con regex pattern), ProposalResponse (con courses, progress 0.0-1.0), ProposalListResponse. (6) **5 endpoint proposals**: POST /proposals (company crea proposta, valida talent pubblico e corsi attivi), GET /proposals (lista con filtro per user_type, talent non vede draft), GET /proposals/{id} (dettaglio con auth owner/recipient), PATCH /proposals/{id} (transizioni di stato: talent sent->accepted/rejected, company draft->sent e update message/budget su draft), PATCH /proposals/{id}/courses/{course_id} (talent completa corso, auto-complete proposta quando tutti i corsi sono completati). (7) **Dependency get_current_company_user** che wrappa get_current_user e verifica user_type=company con 403 se non lo e'. (8) **Seed ampliato** con 3 aziende (TechFlow Italia, AI Solutions Srl, DataSphere) e 3 proposte con corsi. (9) **47 nuovi test**: 37 per proposals routes (dependency, helper, CRUD completo, transizioni, auto-complete), 5 per company signup/auth, 5 per schema validation. Totale test: 194 (147+47). Scelta di usare model_validator invece di field_validator per la validazione company_name perche' il field_validator non scatta quando il campo Optional non e' fornito (default None non triggera il validatore). Scelta di settare esplicitamente id, created_at e updated_at nel route create_proposal perche' i default SQLAlchemy non scattano con mock DB nei test unitari
- **Test E2E Playwright per Company Accounts & Contact Flow**: creata suite completa di 29 test Playwright in `apps/web/e2e/proposals.spec.ts` per la feature Company Accounts & Contact Flow. Test organizzati in 8 gruppi: (1) **Company Signup Flow** (4 test): verifica tab talent/company nel form signup, campi company-specific (nome azienda, referente, email, sito web, settore con 11 opzioni), signup company con redirect a /it/talenti, validazione campo nome azienda required. (2) **Login Redirect Logic** (2 test): company login redirecta a /it/talenti, talent login redirecta a /it/jobs. (3) **Navbar Role-Based Items** (3 test): company vede "Le mie Proposte" e NON vede profilo/candidature, talent vede profilo/candidature e NON vede company proposals, avatar company mostra iniziale del company_name. (4) **Talent Detail Company CTA** (3 test): company autenticata vede "Proponi un Percorso" con link a nuova proposta, CTA naviga a pagina creazione proposta con talent_id, utente non autenticato vede CTA generico "Interessato a questo talento?". (5) **Proposal Creation Page** (4 test): display info talento e lista corsi, selezione/deselezione corsi con counter, submit proposta con redirect a dashboard, validazione "almeno un corso" senza corso selezionato. (6) **Company Proposals Dashboard** (4 test): tab status (Tutte/Bozze/Inviate/Accettate/Rifiutate/Completate), progress bar con "X di Y corsi completati", filtro tab funzionante, lista corsi espandibile. (7) **Talent Proposals Dashboard** (5 test): proposte ricevute con nome azienda, status badge colorati, lista corsi espandibile, bottone "Segna come completato" su proposta accettata, budget e progresso visibili. (8) **Auth Guards** (4 test): redirect a login per utente non autenticato su /it/proposte e /it/azienda/proposte, talent redirectato da /it/azienda/proposte a /it/proposte, company accede a /it/candidature (empty state). Credenziali di test: talent `marco.rossi@email.it`, company `hr@techflow.it` (dal seed reale). Helper login riutilizzabili `loginAsTalent` e `loginAsCompany`. Scoperto che le credenziali company specificate nel task (`hr@techvision.it`) non corrispondevano al seed reale (`hr@techflow.it`). Trovato bug server API che ritornava 500 per stale process — risolto con restart. Tutti i 65 test E2E (36 esistenti + 29 nuovi) passano stabilmente in ~1.7 minuti
- **Company Accounts & Contact Flow (Frontend)**: implementato il frontend completo per account aziendali e flusso di contatto con proposte formative. (1) **Auth types aggiornati**: aggiunti `user_type`, `company_name`, `company_website`, `company_size`, `industry` a `BackendUser` (auth.ts) e `User` (use-auth.ts). Aggiunto `isCompany: boolean` al return di `useAuth()` calcolato come `user?.user_type === "company"`. (2) **Signup con dual user type**: aggiunto toggle "Sono un Talento" / "Sono un'Azienda" con stile tab azure-600. Form company mostra campi aggiuntivi: nome azienda (required), nome referente, email aziendale, sito web (opzionale), settore (dropdown con 10 opzioni: Fintech, AI/ML, SaaS, E-commerce, HealthTech, EdTech, Cybersecurity, Data & Analytics, Consulenza, Altro). Redirect post-signup: talent -> /it/jobs, company -> /it/talenti. (3) **Login con redirect condizionale**: dopo login, company -> /it/talenti, talent -> /it/jobs tramite useEffect su `isCompany`. (4) **Navbar role-based**: per company: avatar con iniziale company_name, link "Le mie Proposte" a /it/azienda/proposte nel dropdown aziende e right-side; nascosti link talent-specific (profilo, candidature). Per talent: aggiunto link "Le mie Proposte" a /it/proposte nel dropdown talenti. Mobile menu con stessa logica. (5) **Talent detail con CTA company**: se isCompany && isAuthenticated, il CTA in fondo alla pagina diventa "Proponi un Percorso" con link a /it/azienda/proposte/nuova?talent_id={id} invece del generico "Scopri Craft Your Developer". (6) **Pagina proposte talent** (/it/proposte): auth guard (redirect login se non autenticato, redirect /it/azienda/proposte se company). Hero, tab status (Tutte/Inviate/Accettate/Rifiutate/Completate) con badge conteggio. Card proposta: company name + industry badge, messaggio troncato, budget range, status badge colorato (sent=azure, accepted=green, rejected=red, completed=purple), progress bar con "X di Y corsi completati", lista corsi espandibile con checkmark, bottoni Accetta/Rifiuta (status sent) e "Segna come completato" sui corsi (status accepted). Empty state con suggerimento di rendere profilo pubblico. (7) **Pagina proposte company** (/it/azienda/proposte): auth guard company-only. Stessa struttura della pagina talent ma con talent_name/talent_role al posto di company info. Empty state con link "Scopri i Talenti". (8) **Pagina creazione proposta** (/it/azienda/proposte/nuova): auth guard company. URL param talent_id per fetch e display info talento (avatar, nome, ruolo, location, skills read-only). Selezione corsi da catalogo con checkbox, ricerca inline, badge livello. Lista corsi selezionati riordinabile con frecce su/giu'. Textarea messaggio e input budget range opzionale. Submit con validazione (almeno 1 corso). Redirect a /it/azienda/proposte dopo successo. (9) **Traduzioni i18n**: 80+ nuove chiavi aggiunte per auth (company fields), nav (proposals links), proposals (titoli, sottotitoli, tab, status, card, actions, create, empty states), industry (10 settori), talents.detail (proposeTraining). TypeScript check passato con zero errori. Scelte architetturali: tutte le pagine seguono il pattern single-file del progetto; hook ordering rispettato (useTranslations -> useRouter -> useAuth -> useState); tutti gli elementi interattivi hanno cursor-pointer; API calls con accessToken da useAuth; nessun barrel file creato
- **Refactoring API: architettura domain-driven**: migrata l'intera struttura delle API da una struttura flat (routes come file singoli + cartella `schemas/` separata) a un'architettura domain-driven. Ogni feature e' ora una cartella con `__init__.py` (re-export router), `router.py` (handler) e `schemas.py` (Pydantic models co-locati). Le risorse figlie sono sotto-cartelle del genitore: `profile/experiences/` e `profile/educations/` sono figli di `profile/`, con composizione via `router.include_router()` nel `__init__.py` del genitore. `main.py` importa solo i router top-level. Struttura risultante: 8 domini top-level (auth, jobs, applications, news, courses, profile, talents, proposals) + 2 sotto-domini (experiences, educations). Aggiornati tutti e 9 i file di test con i nuovi import path. Eliminati tutti i file flat originali e l'intera cartella `schemas/`. Risolto un problema critico di naming collision: `__init__.py` che esporta `router` (oggetto APIRouter) shadowa il sotto-modulo `router.py` quando si usa `unittest.mock.patch` con path stringa — risolto con `importlib.import_module` + `patch.object`. 209 test passano al 100%. Code review approvata con 2 issue High (proposals router >150 righe, N+1 query in list_proposals), 5 Medium (Pydantic Config deprecato, hardcoded year 2030, \_helper cross-module, UserResponse/ProfileResponse duplicati), 4 Low. Aggiornati entrambi gli agenti BE (feature-builder e code-reviewer) con le nuove regole di architettura domain-driven prima del refactoring
- **Craft Your Developer flow completion (Backend)**: implementate 4 feature per completare il flusso CYD lato backend. (1) **Enhanced Training Execution + Gamification**: aggiunti 5 nuovi campi a ProposalCourse (started_at, talent_notes, company_notes, deadline, xp_earned) e 2 a Proposal (total_xp, hired_at, hiring_notes). Creato modello ProposalMilestone per tracciare i traguardi (course_started, course_completed, first_course, streak_3, 25/50/75/100 percent). Sistema XP basato sul livello del corso (beginner=100, intermediate=200, advanced=300) con bonus milestones (+10 start, +25 first course, +50 progress thresholds, +100 streak). 3 nuovi endpoint: PATCH .../start (talent avvia corso), PATCH .../notes (talent aggiorna note), PATCH .../company-update (company aggiorna note e deadline). Endpoint complete_proposal_course arricchito con calcolo XP, creazione milestones e tracking streak. (2) **Course Delivery Dashboard**: nuovo endpoint GET /proposals/{id}/dashboard che ritorna la ProposalResponse arricchita con tutti i campi computati (is_overdue, days_remaining, course_url, course_duration, course_category). (3) **Communication System**: creato sotto-dominio routes/proposals/messages/ con 3 file (router.py, schemas.py, **init**.py). Modello ProposalMessage con indici su proposal_id e created_at. 2 endpoint: GET (lista paginata ordinata ASC) e POST (creazione messaggio). Access control: solo company_id o talent_id della proposta, solo status accepted/completed/hired. Schema MessageResponse include sender_name e sender_type risolti dal modello User. Router incluso nel parent proposals/**init**.py. (4) **Hire After Training**: aggiunta transizione di stato accepted->hired e completed->hired. Quando si passa a "hired": si setta hired_at e hiring_notes sulla proposta, si aggiorna il talent con availability_status="employed" e adopted_by_company=company_name. ProposalUpdate schema aggiornato con regex che include "hired" e campo hiring_notes. (5) **Seed ampliato**: 4 proposte (1 accepted con progresso, 1 accepted vuota, 1 sent, 1 hired), milestones per proposte con progresso, 5 messaggi tra aziende e talenti, Sara Romano aggiornata come "employed" da DataSphere. (6) **Test completi**: 91 test proposte + 16 test messaggi = 107 test nuovi. Totale suite: 266 test, tutti passanti. Helper factories (\_make_proposal_course, \_make_course, \_make_milestone) per creare mock con tutti i campi impostati correttamente (evita MagicMock che ritorna sub-mock invece di None per i nuovi campi Optional). Scelta di usare helper \_fetch_proposal_data per DRY nel fetch dati correlati (company, talent, courses, milestones). Scelta di non modificare main.py: il messages router e' composto dal parent proposals/**init**.py tramite router.include_router()
- **Craft Your Developer Flow Completion (Frontend)**: implementate tutte e 4 le feature per completare il flusso CYD lato frontend, in parallelo con il backend agent. (1) **Enhanced Training Execution + Gamification UI**: aggiornati i type interfaces in entrambi i constants.ts (talent e company) con 11 nuovi campi su ProposalCourse (started_at, talent_notes, company_notes, deadline, xp_earned, course_url, course_duration, course_category, is_overdue, days_remaining) e 4 nuovi campi su Proposal (total_xp, milestones[], hired_at, hiring_notes). Aggiunto nuovo tipo Milestone e tipi ChatMessage/ChatMessagesResponse. Aggiunto status "hired" ai STATUS_TABS e statusBadgeStyle in entrambi i file. ProposalCard (talent) aggiornata con: XP counter con stella, milestone badges colorati sotto la progress bar, bottone "Inizia" per corsi non iniziati, badge "In corso" azure, deadline badge condizionale, link "Vai al Corso" esterno, box azure per company_notes, textarea editabile per talent_notes con salvataggio. CompanyProposalCard aggiornata con stessi elementi gamification + bottone "Assumi Talento" + form inline per company_notes e deadline. (2) **Proposal Detail Pages**: create pagine dettaglio /it/proposte/[id] (talent) e /it/azienda/proposte/[id] (company) con layout timeline verticale. Pattern ultra-thin page.tsx -> main client component. (3) **Communication System (Chat)**: creato ChatSection condiviso con polling ogni 10 secondi, chat bubbles, auto-scroll, input con send su Enter. (4) **Hire After Training**: HireConfirmationModal con warning se corsi incompleti, textarea per hiring notes, success toast, celebration header per stato hired. (5) **i18n**: 100+ nuove chiavi. (6) **Navigation**: Link dalle card ai dettagli. TypeScript zero errori. Scelte: ChatSection in proposte/[id]/\_components importato dalla company page; HireConfirmationModal in azienda/proposte/\_components; nessun barrel file
- **Challenge agent: PR review fixes e hardening**: eseguiti 7 fix identificati dal code review della PR. (1) **BE - Status check su notes/company-update**: aggiunti controlli di stato su update_course_notes e update_course_company — ora funzionano solo con status "accepted", "completed" o "hired", impedendo modifiche su proposte in stato "sent", "rejected" o "draft". (2) **BE - Rimosso parametro inutilizzato**: rimosso il parametro `course` da `_compute_course_fields(pc, course)` che non veniva mai usato, semplificando la firma. (3) **BE - Seed fix Sara Romano**: aggiunto `reskilling_status = "completed"` quando Sara Romano viene segnata come hired, coerenza con lo stato employed. (4) **FE - milestoneColor estratta**: funzione duplicata in 4 file componente estratta in entrambi i `_utils/constants.ts` (talent e company side), eliminati 4 blocchi di codice duplicato. (5) **FE - courseStatusIcon estratta**: funzione duplicata in 2 pagine dettaglio estratta in `proposte/_utils/courseStatusIcon.tsx` (file TSX perche' ritorna JSX con icone lucide-react), importata da entrambe le pagine dettaglio. Rimossi import inutilizzati (Check, Play) da AziendaPropostaDetailPage dopo l'estrazione. (6) **FE - Dead code e deduplicazione**: rimossa `formatBudget` (no-op: ritornava l'input invariato) da entrambi i constants.ts e tutti i 4 file che la importavano. Rimossa `formatDeadlineDate` (identica a `formatDate`), aggiornati tutti i caller per usare `formatDate`. (7) **FE - Accessibilita' htmlFor**: aggiunti `htmlFor` ai `<label>` e `id` ai `<input>` per le deadline in CompanyProposalCard e AziendaPropostaDetailPage, associando label e input per screen reader. Scritti 10 nuovi test per le status check (5 per notes: 3 reject su sent/rejected/draft + 2 success su completed/hired; 5 per company-update: 3 reject + 2 success). Totale test: 276 (era 266). TypeScript zero errori
- **E2E Suite Firefox cross-browser verification**: eseguita l'intera suite E2E (65 test) su Firefox dopo il testing manuale su Chromium. Installato Firefox via `npx playwright install firefox`. Primo run: 64/65 pass, 1 fail su "accepted proposal shows Segna come completato on courses" — il test cercava il vecchio testo bottone pre-gamification ("Segna come completato"), ma con il nuovo flusso i corsi non iniziati mostrano "Inizia" e quelli iniziati "Completa Corso". Fix: sostituito locator con regex `button hasText /^(Inizia|Completa Corso)$/` + `scrollIntoViewIfNeeded()` (i bottoni erano sotto il fold). Re-run: 65/65 pass su Firefox in 3.1 minuti. Nota: `locator.isVisible()` di Playwright non accetta timeout come parametro (e' un check istantaneo), quindi il pattern `Promise.race` con `isVisible({timeout})` non funziona — meglio usare `expect(locator).toBeVisible({timeout})` o `scrollIntoViewIfNeeded()` prima
- **AI-Powered Job Matching & Career Recommendations (Backend)**: implementato il backend completo per le feature AI con Gemini. (1) **AICache model**: nuovo modello SQLAlchemy per cachare le risposte Gemini (user_id, cache_type job_matches/career_advice, content_json, model_used, expires_at con TTL 24h), indice composito su user_id+cache_type. (2) **GeminiAdvisor service**: servizio singleton in `api/services/ai_advisor.py` che usa il SDK `google-genai` per chiamare Gemini. Due metodi principali: `match_jobs()` (profilo utente vs lista job, ritorna score 0-100 con motivazioni) e `career_recommendations()` (direzione carriera, corsi consigliati, articoli consigliati, skill gap). Gestione errori completa con try/catch, fallback su None, parsing JSON con validazione struttura. Configurazione via env GOOGLE_API_KEY e GEMINI_MODEL. (3) **Prompt templates**: creata cartella `apps/api/prompts/` con 2 template in italiano: `job_matcher.md` (analisi sovrapposizione competenze, livello esperienza, location/work_mode, ruolo) e `career_advisor.md` (direzione carriera, 3 corsi, 3 articoli, skill gap). Entrambi richiedono output JSON strutturato. (4) **4 endpoint AI**: POST /ai/job-matches (genera match, cachea risultato), GET /ai/job-matches (ritorna cache valida o 404), POST /ai/career-advice (genera raccomandazioni, usa cache job-matches se disponibile, altrimenti genera prima i match), GET /ai/career-advice (ritorna cache valida o 404). Tutti richiedono auth JWT, ritornano 503 se Gemini non disponibile. (5) **Helper functions**: `_build_user_profile_dict` (include esperienze), `_build_jobs_list` (troncamento descrizione a 300 char), `_build_courses_list`, `_build_news_list` (troncamento summary a 200 char), `_get_valid_cache` (gestione naive datetime da SQLite), `_save_cache` (delete vecchia cache + insert nuova). (6) **57 test unitari**: copertura completa di helpers (profilo, jobs, courses, news, cache), endpoint POST/GET per entrambi i domini, schema validation Pydantic (score bounds, required fields), servizio GeminiAdvisor (disponibilita', parsing JSON, fallback). Test pattern: `importlib.import_module` + `patch.object` per mocking (learning #23), gestione naive datetime da SQLite (learning #26), `_setup_db_for_generate` con `query.side_effect` per simulare query su modelli diversi. Totale suite: 333 test, tutti passanti. Scelta architetturale: il servizio e' un singleton per evitare di ricreare il client ad ogni richiesta. La cache e' per utente con TTL 24h per bilanciare freshness e costi API Gemini. I prompt sono file .md esterni per facilitare il tuning senza toccare il codice
- **AI-Powered Job Matching e Career Advisor (Frontend)**: implementata l'interfaccia utente per le due nuove feature AI. (1) **AI Job Match su pagina Jobs**: aggiunti tipi `JobMatchResult` e `JobMatchResponse` in `jobs/_utils/types.ts`. Creato hook `useAIJobMatch` che gestisce generazione match (POST /ai/job-matches), caricamento cache (GET /ai/job-matches), e lookup per singolo job. Modificato `JobsPage.tsx` con bottone "AI Match" (icona Sparkles) visibile solo per utenti autenticati, loading spinner durante l'analisi, info banner con data generazione, e ordinamento "Migliori Match" che sorta per score decrescente. Modificato `JobCard.tsx` con badge score colorato in alto a destra (verde >=80%, giallo 60-79%, grigio <60%) e tooltip on-hover con lista dei motivi del match. Modificato `JobDetailDialog.tsx` con sezione dedicata "Dettagli AI Match" (sfondo azure-50) che mostra score badge e lista motivi. (2) **AI Career Advisor su pagina Profilo**: aggiunti tipi `RecommendedCourse`, `RecommendedArticle`, `CareerAdviceResponse` in `profilo/_utils/constants.ts`. Creato hook `useAICareerAdvice` con generazione consigli (POST /ai/career-advice), caricamento cache, e arricchimento dati corsi/articoli tramite fetch individuali. Creato componente `AICareerAdvisor` come pannello collapsibile: header con icona Sparkles e bottone "Genera consigli"/"Rigenera", sezione "Direzione Carriera" (sfondo azure-50), pill "Competenze da Sviluppare" (sfondo red-50), griglia 3 colonne "Corsi Consigliati" con badge livello e motivazione AI, griglia 3 colonne "Articoli Consigliati" con link esterno. Stati gestiti: loading con skeleton pulse, errore con retry, empty state se mancano skills. Modificato `ProfiloPage.tsx` per includere AICareerAdvisor dopo la sezione formazione. (3) **Traduzioni i18n**: aggiunte 11 chiavi in `jobs.aiMatch` e 13 chiavi in `profile.aiAdvisor`. TypeScript check passato senza errori. Scelte architetturali: hook separati per le due feature AI per mantenere il pattern single-responsibility; match Map keyed by job_id per lookup O(1); enrichment dei dati corso/articolo asincrono post-fetch per non bloccare il rendering; pannello collapsibile di default per non appesantire la pagina profilo; nessun barrel file creato
- **PR Review AI Features + Challenge Fixes**: eseguito code review parallelo BE e FE delle feature AI. BE: 2 blocker (prompt injection via `str.format()` con dati utente contenenti `{}` — fixato sostituendo con `.replace()`; singleton non thread-safe — fixato con `threading.Lock`), 4 critical (accesso attributo privato `_model` — aggiunta property `model_name`; no rate limiting su POST; cache save senza transaction protection; fetch ALL jobs in memory — aggiunto `.limit(100)`). FE: 3 critical (stringhe italiane hardcoded in JobCard e AICareerAdvisor — fixato con `useTranslations`; `matchBadgeStyle` duplicato — estratto in `constants.ts`; `levelLabel` hardcoded — sostituito con traduzioni `courses.levels`), 4 major (button-inside-button a11y — ristrutturato header con button separati; tooltip solo mouse — aggiunto `onFocus`/`onBlur` con ARIA `role="tooltip"`; no `aria-live` — aggiunto su pannello collapsibile; loading guard mancante — aggiunto `disabled` state). Score clamping ora applicato anche nel service layer (non solo router). Tutti 333 test BE passanti, 0 errori TypeScript dopo le fix
- **E2E AI Features**: testato manualmente il flusso AI completo con Playwright MCP. 16 test case su 3 flussi: Jobs Page (bottone AI Match visibile solo autenticati, loading + gestione errore 503 graceful, sort "Best Match" condizionale), Profilo (pannello AI Career Advisor collapsibile, bottone genera/rigenera, gestione 503 con messaggio errore + retry), Full Journey (navigazione fluida tra pagine, tutte le feature funzionanti). 16/16 PASS. Nessun bug trovato — la degradazione graceful quando GOOGLE_API_KEY non è impostato funziona correttamente su tutti gli endpoint
- **Swagger/OpenAPI documentation batch 2**: aggiunta documentazione Swagger/OpenAPI completa a 8 file (4 router + 4 schemas) del secondo batch. (1) **Talents Router**: aggiunto `summary` e `openapi_extra={"security": []}` ai 2 endpoint pubblici (GET list + GET detail), aggiunto `responses` 404 sul detail. (2) **Talents Schemas**: aggiunte `Field(description=...)` a tutti i campi di TalentCardResponse, TalentCardListResponse e TalentDetailResponse. (3) **Proposals Router**: aggiunto `summary` e `responses` (401, 403, 404) a tutti i 9 endpoint (create, list, get, dashboard, update, complete course, start course, notes, company-update). (4) **Proposals Schemas**: aggiunte `Field(description=...)` a tutti i campi chiave di MilestoneResponse, ProposalCourseResponse, ProposalCreate, ProposalUpdate, ProposalResponse, ProposalListResponse, CourseNotesUpdate e CompanyCourseUpdate. (5) **Proposals Messages Router**: aggiunto `summary` e `responses` (401, 403, 404) ai 2 endpoint (list e create). (6) **Proposals Messages Schemas**: aggiunte `Field(description=...)` a MessageCreate, MessageResponse e MessageListResponse. (7) **AI Router**: aggiunto `summary` e `responses` (401, 503 o 404) a tutti i 4 endpoint (POST/GET job-matches, POST/GET career-advice). (8) **AI Schemas**: aggiunte `Field(description=...)` a JobMatchItem, JobMatchResponse, RecommendedCourse, RecommendedArticle e CareerAdviceResponse. Zero logica modificata, 333 test passanti, zero errori import. Pattern seguiti: `openapi_extra={"security": []}` per endpoint pubblici, response code 503 per AI service failures, descrizioni concise e informative per i field Pydantic
- **Swagger/OpenAPI documentation completa**: implementata documentazione Swagger/OpenAPI per l'intera API FastAPI, usando come riferimento il progetto 3bee-helpdesk. (1) **openapi.py centralizzato**: creato `apps/api/api/openapi.py` con `TAGS_METADATA` (13 tag con nome e descrizione per ogni dominio: Auth, Jobs, Applications, News, Courses, Profile, Profile - Experiences, Profile - Educations, Talents, Proposals, Proposals - Messages, AI, Health) e funzione `custom_openapi()` che genera schema arricchito con: JWT Bearer security scheme globale, servers configuration, contact info, descrizione markdown con overview, features, authentication e account types. (2) **main.py aggiornato**: aggiunto `openapi_tags=TAGS_METADATA` al costruttore FastAPI, assegnato `app.openapi = lambda: custom_openapi(app)`, documentato l'endpoint `/health` con tag, summary, description e response example. (3) **Batch 1 — 8 router + 8 schemas** (eseguito da agent parallelo): auth (3 endpoint: summary + responses 400/401/409/422), jobs (1 endpoint: summary + `openapi_extra={"security": []}` per endpoint pubblico), applications (3 endpoint: summary + responses 401/404/409), news (2 endpoint: summary + security override pubblico), courses (2 endpoint: summary + security override pubblico), profile (2 endpoint: summary + responses 401), experiences (3 endpoint: summary + responses 401/404 + docstring), educations (3 endpoint: summary + responses 401/404 + docstring). Schemas: `Field(description=...)` aggiunto a tutti i campi chiave di SignupRequest, LoginRequest, TokenResponse, UserResponse, JobResponse, ApplicationCreate/Response, NewsResponse, CourseResponse, ProfileUpdate/Response, ExperienceCreate/Update/Response, EducationCreate/Update/Response. (4) **Batch 2 — 8 router + 8 schemas** (eseguito da agent parallelo): talents (2 endpoint pubblici con security override + responses 404), proposals (9 endpoint con summary + responses 401/403/404), proposals/messages (2 endpoint), ai (4 endpoint con responses 401/503/404). Schemas: Field descriptions su tutti i modelli Pydantic dei 4 domini. (5) **Verifica**: tutti 333 test passanti, Swagger UI funzionante su http://localhost:8000/docs con tutti 28 endpoint documentati, schema security e tag correttamente applicati. Pattern architetturale: centralizzazione in openapi.py (come 3bee-helpdesk), `openapi_extra={"security": []}` per override su endpoint pubblici, descrizioni Field concise e informative
- **Email Notifications + Daily Digest (Frontend)**: implementata l'intera interfaccia utente per il sistema di notifiche email e digest giornaliero. (1) **Architettura**: seguita la struttura feature-scoped con `notifiche/_components/`, `_hooks/`, `_utils/`. Page.tsx ultra-thin che renderizza solo `NotifichePage`. Due hook condivisi in `src/lib/hooks/` (`useUnreadCount` e `useNotificationPreferences`) per evitare import circolari tra Navbar e pagina notifiche. Hook feature-scoped `useEmails` per la lista email con paginazione, filtri, mark-as-read. (2) **NotifichePage**: orchestrator principale con header gradient azure, barra tab filtri (Tutte/Non lette/Proposte/Corsi/Traguardi/Assunzioni/Digest), il filtro "Non lette" usa `is_read=false` mentre gli altri usano `email_type` mapping da `EMAIL_TYPE_FILTERS`. (3) **EmailList**: loading skeleton (3 pulse card), empty state con icona Bell, header "Segna tutte come lette" condizionale, card list, paginazione identica al pattern Jobs. (4) **EmailCard**: bottone full-width con indicatore non-letto (icona Mail con dot blu vs MailOpen grigia), sender, subject, badge tipo colorato, timestamp relativo. Background azure-25 per non letti. (5) **EmailDetailDialog**: dialog full-screen pattern identico a JobDetailDialog (backdrop blur, ESC to close, body scroll lock), body HTML renderizzato via `dangerouslySetInnerHTML` (sicuro perche' generato dal backend), link "Vai alla Proposta" se `related_proposal_id` presente. (6) **NotificationPreferences**: pannello collapsibile stile AICareerAdvisor con due toggle switch custom (azure-600 on, neutral-300 off, white circle animata), "Genera Digest Ora" condizionale, display canale Email con nota Telegram in arrivo, feedback "Preferenze salvate!" temporaneo. (7) **Navbar**: aggiunto link "Notifiche" con icona Bell per utenti autenticati (sia talent che company), badge rosso con conteggio non letti (99+ se >99), visibile sia in desktop che mobile menu. Hook `useUnreadCount` con polling ogni 60 secondi. (8) **Profilo**: aggiunto `NotificationPreferencesSection` dopo AICareerAdvisor con due toggle rapidi. (9) **i18n**: 50+ nuove chiavi nel namespace `notifications` con sottosezioni tabs, emailTypes, detail, preferences, pagination. Aggiunto `nav.notifications`. (10) **TypeScript**: zero errori di compilazione. Scelte: hook condivisi per evitare duplicazione tra Navbar e pagina; toggle switch custom invece di libreria UI per coerenza con il design system; `formatRelativeTime` utility per timestamp human-friendly; `emailTypeBadgeStyle` con colori coerenti alla palette Datapizza
- **Email Notifications + Daily Digest (Backend)**: implementato il backend completo per il sistema di notifiche email locale (no SMTP, tutto salvato in DB). (1) **Database models**: aggiunti `EmailLog` (recipient_id, recipient_email, sender_label, email_type con 8 tipi supportati, subject, body_html/text, related_proposal_id, is_read, created_at con indici compositi su recipient_id+created_at) e `NotificationPreference` (user_id unique, email_notifications, daily_digest come Integer/SQLite boolean, channel) dopo `AICache` in `models.py`. (2) **EmailService**: servizio statico in `api/services/email_service.py` con 9 metodi: `send_email` (core: lookup utente, check preferenze con default all-enabled, crea EmailLog), `send_proposal_received` (a talent), `send_proposal_accepted/rejected` (a company), `send_course_started/completed` (a company), `send_milestone_reached` (a talent), `send_hiring_confirmation` (a entrambi, ritorna list[EmailLog]), `generate_daily_digest` (check pref daily_digest, usa AICache career_advice se disponibile altrimenti fallback a 3 corsi recenti). Template HTML con wrapper Datapizza (sfondo #1b64f5, border-radius 12px). (3) **Notification routes**: domain package `routes/notifications/` con router.py, schemas.py, __init__.py. 8 endpoint: GET /emails (paginazione, filtro per email_type e is_read), GET /emails/{id} (auto-mark read), PATCH /emails/{id}/read, PATCH /emails/read-all (batch), GET /unread-count, GET/PATCH /preferences, POST /daily-digest. Tutti con JWT auth. Registrato in main.py. (4) **Integrazione proposals router**: aggiunto import EmailService e chiamate try/except nei punti chiave: create_proposal (proposal_received a talent), update_proposal (accepted/rejected a company, hiring_confirmation a entrambi), start_proposal_course (course_started a company), complete_proposal_course (course_completed + milestone_reached). I try/except assicurano che un errore nelle notifiche non blocchi mai il flusso principale. (5) **Seed data**: aggiunto `seed_notification_preferences()` (preference per tutti gli utenti) e `seed_email_logs()` (5 email esempio: proposal_received, proposal_accepted, course_started, daily_digest, milestone_reached). (6) **44 test unitari**: 20 test per EmailService (send_email con/senza preferenze, user not found, tutti i send_* verificano tipo e destinatario, hiring_confirmation crea 2 email, daily_digest con cache/fallback/disabled/malformed JSON), 24 test per routes (list con paginazione e filtri, get con auto-mark read e 404, mark read single/batch, unread count, preferences defaults/saved/create/update/partial, daily digest genera/disabled, schema validation). Pattern: `importlib.import_module` + `patch.object` (learning #23), `_setup_db_for_send_email` con side_effect per query multiple su modelli diversi. Fix Python 3.9: usato `Optional[str]` invece di `str | None` nei parametri delle route FastAPI (le annotazioni lazy via `__future__` non funzionano con l'evaluation di FastAPI su 3.9). Fix test esistenti: 2 test proposals (`test_create_proposal_success`, `test_talent_accepts_proposal`) fallivano per `assert_called_once()` su commit dato che EmailService aggiunge un commit aggiuntivo — cambiato a `assert_called()`. Totale: 377 test, tutti passanti
- **BE Code Review — Email Notifications + Daily Digest**: eseguita code review completa di tutti i 10 file backend del feature (6 nuovi + 4 modificati). **Nessun blocker o critical trovato** — la feature ha sicurezza solida (auth su tutti gli endpoint, data isolation con recipient_id==current_user.id, nessun SQL injection, input validati con Pydantic). **4 issue MAJOR fixati**: (1) mancava `response_model` su 3 endpoint (`mark_email_read`, `mark_all_emails_read`, `get_unread_count`) — aggiunti `OkResponse`, `MarkAllReadResponse`, `UnreadCountResponse` in schemas.py; (2) `trigger_daily_digest` ritornava due tipi diversi (dict o EmailLogResponse) senza `response_model` — aggiunto `Union[EmailLogResponse, DigestDisabledResponse]`; (3) tutti i metodi di EmailService avevano parametri `proposal`, `talent`, `company` senza type hint — aggiunti `Proposal`, `User` type hints su tutti i 9 metodi. **2 issue MINOR non fixati**: deprecation warnings su `class Config` (pre-esistente in tutto il progetto, non specifico di questa feature); router.py 264 righe (leggermente sopra il guideline di 150 ma accettabile per 8 endpoint). **Verifica architetturale**: domain-driven folder structure corretta, schemas co-located, parent-child composition, main.py importa solo router top-level. **Test**: tutti 377 test passanti dopo le fix. Learning #23 (importlib per mock router) correttamente applicato nei test. Learning #25 (SQLAlchemy create_all) e #26 (naive datetime) non applicabili qui ma verificati
- **FE Code Review — Email Notifications + Daily Digest**: eseguita code review completa di tutti i 14 file frontend della feature (11 nuovi + 3 modificati). Revisione sistematica su 9 categorie: architettura pagina, type safety, barrel files, hook ordering, sicurezza, i18n, accessibilita', performance, style consistency. **Nessun blocker trovato**. **2 issue CRITICAL fixati**: (1) `formatRelativeTime` in `constants.ts` aveva 4 stringhe italiane hardcoded ("Adesso", "min fa", "ore fa", "giorni fa") — refactored per accettare funzione `t` come parametro e usare nuove chiavi i18n `notifications.time.*`, aggiornato `EmailCard.tsx` per passare `t`; (2) `dangerouslySetInnerHTML` in `EmailDetailDialog.tsx` senza sanitizzazione — classificato come MINOR dato che il body_html proviene esclusivamente da template server-side (`EmailService._email_wrapper()`), nessun user input nel HTML. **4 issue MAJOR fixati**: (3) handler `handleEmailClick`, `handleFilterChange`, `handleMarkAllRead`, `handlePageChange` in `NotifichePage.tsx` erano funzioni normali ricreate ad ogni render — convertiti in `useCallback` con dipendenze corrette; (4) switch buttons in `NotificationPreferences.tsx` e `NotificationPreferencesSection.tsx` mancavano `aria-label` — aggiunti su tutti e 4 i toggle; (5) bottone expand/collapse in `NotificationPreferences.tsx` mancava `aria-expanded` — aggiunto. **Issue reclassificati**: hardcoded `/it/proposte` in EmailDetailDialog reclassificato da CRITICAL a INFO perche' l'intero codebase usa `/it/` hardcoded (app solo italiana). **Positivi**: architettura pagina corretta (page.tsx ultra-thin, feature-scoped dirs), zero `any` types, hook ordering corretto in tutti i componenti, polling cleanup corretto in useUnreadCount, no barrel files, cursor-pointer su tutti gli elementi interattivi, design system Datapizza rispettato. **TypeScript**: zero errori dopo le fix
- **E2E Testing manuale del flusso CYD completo**: eseguito test E2E completo con Playwright MCP browser tools su 3 parti. **Bug critici trovati e fixati**: (1) **Schema DB mismatch**: il database SQLite era stato creato prima dell'aggiunta dei campi CYD (total_xp, hired_at, hiring_notes su proposals; started_at, talent_notes, company_notes, deadline, xp_earned su proposal_courses) — SQLAlchemy create_all non aggiunge colonne a tabelle esistenti. Risolto eliminando il DB e ricreandolo con seed. (2) **Naive vs Aware datetime**: `TypeError: can't subtract offset-naive and offset-aware datetimes` in `_compute_course_fields` — la deadline da SQLite e' naive ma `datetime.now(timezone.utc)` e' aware. Fixato con check `pc.deadline if pc.deadline.tzinfo else pc.deadline.replace(tzinfo=timezone.utc)` in `apps/api/api/routes/proposals/router.py`. **Risultati test**: Part 1 (Company Flow): login azienda, dashboard proposte con XP/milestones/progress/status tabs, dettaglio con timeline corsi + chat + bottone assumi — tutti PASS. Part 2 (Talent Flow): login talento, dashboard proposte, avvio corso con XP +35 e milestones "Corso Iniziato"/"Primo Corso!", invio messaggio in chat, verifica stato hired con celebration 650 XP — tutti PASS. Part 3 (Full Round-Trip): login company -> browse talenti -> crea proposta per Elena Colombo (2 corsi AI, messaggio, budget 3.000-5.000) -> logout -> login come Elena -> vede proposta "Inviata" -> accetta -> status diventa "Accettata" -> avvia corso -> XP +35 e milestones -> invia messaggio in chat -> logout -> login company -> vede progresso Elena (35 XP, milestones, "In corso") -> legge messaggio Elena -> risponde in chat -> bidirectional chat funzionante — tutti PASS. Nota tecnica: il metodo Playwright `fill()` non triggera React `onChange` sugli input controllati — per la chat e' stato necessario usare `browser_evaluate` con native input value setter + dispatchEvent per aggiornare lo stato React, e poi `element.click()` via evaluate per il bottone send
- **Sostituzione completa seed data News e Courses con URL freschi e verificati**: su richiesta dell'utente, sostituito tutto il seed data per news e corsi con contenuti freschi cercati e verificati via WebFetch. **News (10 articoli)**: sostituiti i vecchi HN IDs e TLDR Tech links con: (1) 5 articoli da fonti primarie (Mozilla Hacks — Firefox 148 Sanitizer API, Stripe Newsroom — $159B valuation, WithDiode — hardware simulator, Keep Android Open — lettera aperta a Google, Morning Overview — data breach USA); (2) 3 articoli TLDR Tech (Spyglass — OpenAI smart speaker, Cloudflare Blog — Code Mode MCP, Kasava Dev — AI as exoskeleton); (3) 2 articoli TechCrunch (Particle AI podcast clips, Google VP startup warning). **Corsi (10 corsi)**: aggiornati con URL e dati freschi: (1) 5 Coursera verificati via WebFetch 200 OK (Machine Learning Specialization — Andrew Ng/4.8M studenti, Deep Learning Spec, Prompt Engineering for ChatGPT, Generative AI with LLMs, AI For Everyone); (2) 5 Udemy con slug verificati via web search e Class Central (Machine Learning A-Z, Deep Learning A-Z — nuovo, Python for DS&ML Bootcamp — nuovo, AI Engineer Core Track/Ed Donner — nuovo, Complete AI&ML Bootcamp). Tutti i 20 URL verificati. DB ri-seedato (`rm datapizza.db && python3 -m api.database.seed`), backend riavviato. Test Playwright: news page mostra 10 card, click → dialog → "Leggi l'articolo" apre Mozilla Hacks in nuovo tab OK; courses page mostra 10 card, click → dialog → "Vai al Corso" apre Coursera in nuovo tab OK. 377 test BE passanti
- **Vercel Deployment (Backend + Frontend)**: deploying completo di entrambi i progetti su Vercel (account personale `valeriosciscis-projects`). **Backend** (`api-three-beta-80.vercel.app`): deploy con `@vercel/python` runtime, SQLite DB bundled con il progetto. Problema critico: il filesystem di Vercel e' read-only (`/var/task/`), quindi le operazioni di scrittura SQLite fallivano con "attempt to write a readonly database". Root cause: il file `.env` locale contenente `DATABASE_URL=sqlite:///./datapizza.db` veniva deployato e sovrascriveva la logica di copia a `/tmp`. Fix applicato in due parti: (1) aggiornato `connection.py` con logica robusta che rileva filesystem read-only tramite `Path.touch()` e copia automaticamente il DB in `/tmp`; (2) creato `.vercelignore` per escludere `.env`, `.pytest_cache`, `tests/`, `.claude`. Env vars configurate via Vercel API: JWT_SECRET, ALLOWED_ORIGINS, GOOGLE_API_KEY, VERCEL. Disabilitata SSO protection via API Vercel (`PATCH /v9/projects/{id}` con `ssoProtection: null`). **Frontend** (`web-ten-zeta-68.vercel.app`): deploy standard Next.js con env vars NEXT_PUBLIC_API_URL e AUTH_SECRET. CORS configurato dinamicamente via `ALLOWED_ORIGINS`. **E2E Testing su Vercel**: testato con Playwright MCP browser tools — Homepage PASS, Jobs page (10 listings) PASS, Login talent (marco.rossi@email.it) PASS, News (10 articles) PASS, Courses (10 courses) PASS, Logout + Login company (hr@techflow.it) PASS, Browse talents (6 profiles) PASS, Talent detail (Elena Colombo) PASS, Create proposal (2 courses, message, budget) PASS, Company proposals dashboard (3 proposals con XP, milestones, status) PASS, Proposal detail (timeline, chat, hire button) PASS, AI Job Match (95% Senior FE Dev, scores su tutti i 10 jobs) PASS, AI Career Advisor (career direction, 6 skill gaps, 3 courses, 3 articles con Gemini) PASS. Tutti i 377 test unitari passanti
- **FE Code Review Fix + Integrazione Telegram Bot (Frontend)**: applicate tutte le fix dalla code review frontend (7 issue) e implementata l'integrazione UI per il bot Telegram. **Fix code review**: (1) CRITICAL #2 — redirect alla login per utenti non autenticati in NotifichePage (pattern useEffect + router.push come CandidaturePage); (2) CRITICAL #3 — `fetchEmail` in useEmails.ts ora decrementa `unreadCount` solo se l'email era effettivamente non letta (check `emails.find(e => e.id === emailId)?.is_read === false`); (3) MAJOR #9 — aggiunto error banner con icona AlertTriangle e bottone Riprova in NotifichePage quando `error` non e' null; (4) MAJOR #10 — `updatePreferences` nel hook ora fa throw on failure (rimosso try/catch silente), e `handleToggle` in entrambi i componenti (NotificationPreferences + NotificationPreferencesSection) ora wrappa in try/catch mostrando "Salvato" solo su successo; (5) MAJOR #11 — sostituito `<a href>` con Next.js `<Link>` in EmailDetailDialog per il link alla proposta; (6) MINOR #13 — rimossa definizione duplicata di `API_BASE` da useNotificationPreferences.ts e useUnreadCount.ts, ora importano entrambi da constants.ts; (7) MINOR #17 — aggiunto `if (diffMin < 0) return t('time.now')` in formatRelativeTime per gestire date future. **Integrazione Telegram**: (1) aggiornato `NotificationPreference` interface con `telegram_notifications: boolean` e `telegram_chat_id: string | null`; (2) aggiunto `linkTelegram(chatId)` (POST), `unlinkTelegram()` (DELETE) e `telegramLinking` loading state nel hook useNotificationPreferences; (3) sezione Telegram completa in NotificationPreferences — se non collegato: bottone "Collega Telegram" -> istruzioni 3 step (@DatapizzaBot, /start, Chat ID) -> input + bottone Collega; se collegato: badge verde con Chat ID mascherato (ultime 4 cifre), toggle notifiche Telegram, bottone Scollega; (4) NotificationPreferencesSection in profilo — toggle Telegram se collegato, oppure link testuale "Collega Telegram nelle preferenze notifiche" che rimanda a /it/notifiche; (5) channel display dinamico — badge verde Telegram accanto a Email se collegato, altrimenti mini-link "Collega Telegram"; (6) 16 nuove chiavi i18n (telegram*, cancel, errorLoading, retry) + telegramLinkFromProfile. Tutto il codice segue il design system Datapizza (azure-600, pastelgreen, cursor-pointer ovunque), TypeScript strict — zero errori `tsc --noEmit`
- **E2E Testing Email Notifications + Daily Digest**: eseguito test E2E completo con Playwright MCP browser tools su 4 parti (32 test case). **Bug trovati e fixati durante il test**: (1) **Backend email_type filter non accetta lista**: l'endpoint GET /notifications/emails aveva `email_type: Optional[str]` che accettava solo un valore singolo, ma il frontend invia parametri multipli (es. `email_type=proposal_received&email_type=proposal_accepted&email_type=proposal_rejected` per il tab "Proposte"). Fixato cambiando a `email_type: Optional[list[str]] = Query(None)` e usando `.in_()` invece di `==` nel filtro SQLAlchemy. (2) **Credenziali talent errate nel test plan**: il test plan indicava `marco.rossi@example.com` ma il seed usa `marco.rossi@email.it`. (3) **Stale DB connections**: dopo il re-seed del database, il server manteneva connessioni vecchie causando "Invalid credentials" e "User not found". Risolto riavviando il backend. **Bug minore non fixato**: il badge navbar non si aggiorna in real-time dopo "Segna tutte come lette" — richiede navigazione o refresh. **Risultati**: Part 1 (Company Flow, 13 test): login, navigazione notifiche, tab render, email list, email detail dialog, mark all read, navigazione tra pagine — tutti PASS (dialog inizialmente FAIL per DB stale, PASS dopo restart). Part 2 (Talent Flow, 12 test): login talent, notifiche con 3 email types diversi, filtri per tipo (Digest/Traguardi/Proposte/Non lette), preferenze notifiche con toggle e persistenza API, genera digest ora con nuovo email creato e badge aggiornato, email detail dialog con contenuto HTML renderizzato, mark all read, navigazione profilo — tutti PASS. Part 3 (Email Triggers, 4 test): creazione proposta genera email proposal_received per talent, accettazione proposta genera email proposal_accepted per company, completamento corso genera email course_completed per company, avvio corso genera email course_started per company + milestone_reached per talent — tutti PASS. Part 4 (Edge Cases, 3 test): empty state per filtri senza risultati, badge counter accurato (4 corrisponde a 4 non lette), paginazione nascosta quando tutti i risultati entrano in una pagina — tutti PASS. **Score finale: 32/32 PASS** (incluso il retest del dialog dopo fix)
- **BE Code Review Fix + Telegram Bot Integration (Backend)**: eseguite 7 fix dalla code review backend e implementata l'integrazione completa del Telegram Bot. **Fix code review**: (1) **BLOCKER B1** — route path conflict: `PATCH /emails/read-all` veniva matchato come `{email_id}` da FastAPI. Spostato il route `read-all` PRIMA di `{email_id}/read`; (2) **CRITICAL C1** — stored XSS: tutti i valori user-controlled (full_name, company_name, course_title, budget_range, career_direction, skill_gaps, reason) nelle email HTML erano interpolati senza escaping. Aggiunto `from html import escape` e applicato `escape()` su TUTTI i valori user-controlled in TUTTI i metodi `send_*` e `generate_daily_digest` (9 metodi); (3) **MAJOR M1** — email_type filter senza validazione: aggiunto `EMAIL_TYPE_VALUES` come `Literal` con 8 tipi validi, usato nel parametro `Query` di `list_emails`; (4) **MAJOR M2** — channel senza validazione: definito `CHANNEL_VALUES = Literal["email", "telegram", "both"]` e applicato a `NotificationPreferenceUpdate.channel`; (5) **MAJOR M3** — tag Notifications mancante in OpenAPI: aggiunto entry "Notifications" con description in `TAGS_METADATA` di `openapi.py`; (6) **MAJOR M6** — query duplicate nel proposals router: in `update_proposal`, `complete_proposal_course` e `start_proposal_course`, le variabili `company`/`talent` da `_fetch_proposal_data` venivano ignorate e ri-queryate. Rimosse le query duplicate, riusati i dati gia' caricati; (7) **MINOR m5** — indice mancante: aggiunto `Index("ix_email_logs_recipient_type", "recipient_id", "email_type")` a `EmailLog.__table_args__`. **Telegram Bot Integration**: (1) nuovo `TelegramService` in `api/services/telegram_service.py` — `send_message(chat_id, text)` via httpx a Telegram Bot API, `send_notification(db, recipient_id, text)` che verifica preference prima di inviare; (2) modello `NotificationPreference` esteso con `telegram_chat_id = Column(String(50))` e `telegram_notifications = Column(Integer, default=0)`; (3) schema aggiornati: `NotificationPreferenceResponse` con telegram_chat_id e telegram_notifications, `NotificationPreferenceUpdate` con telegram_notifications, `TelegramLinkRequest` con chat_id, `CHANNEL_VALUES` Literal per validazione; (4) 2 nuovi endpoint: `POST /notifications/telegram/link` (salva chat_id, abilita telegram) e `DELETE /notifications/telegram/link` (rimuove chat_id, disabilita telegram); (5) integrazione in `EmailService.send_email()`: dopo ogni EmailLog, chiama `TelegramService.send_notification()` in try/except (mai blocca il flusso principale); (6) helper `_pref_to_response` per conversione preference->schema con campi telegram; (7) seed data aggiornato con telegram_chat_id=None e telegram_notifications=0; (8) 16 nuovi test: 9 per TelegramService (send_message success/failure/no-token/network-error, send_notification enabled/disabled/no-chat/no-pref/failure), 7 per notification routes (link create/update, unlink remove/defaults, schema validation invalid channel, telegram fields in preferences). **Totale test: 393 (da 377), tutti passanti**
- **Telegram Webhook per auto-reply Chat ID**: implementato webhook endpoint `POST /notifications/telegram/webhook` per far rispondere automaticamente il bot @datapizza_notify_bot con il Chat ID dell'utente quando invia `/start`. Questo elimina la necessita' di usare bot terzi (@userinfobot) che non funzionano sempre. **Backend**: (1) 3 nuovi schema Pydantic (TelegramChat, TelegramMessage, TelegramUpdate) per parsare gli update Telegram; (2) endpoint webhook pubblico (no auth) con validazione opzionale del secret token via header `X-Telegram-Bot-Api-Secret-Token`; (3) metodi `set_webhook()` e `delete_webhook()` aggiunti a TelegramService; (4) 16 nuovi test (7 webhook endpoint + 3 schema + 4 set_webhook + 2 delete_webhook) — totale 413 test, tutti passanti. **Frontend**: semplificato wizard Telegram da 3 step a 2 step ("Apri bot e premi Start" + "Copia Chat ID e incolla"). **Webhook registrato** su Telegram puntando al backend Vercel — richiede redeploy per attivare
- **Pianificazione 4 Nuove Feature (Ralph Loop + 4 Planner Agent Paralleli)**: sessione di pianificazione strategica per le prossime 4 macro-feature della piattaforma. Lanciati 4 agenti planner in parallelo, ciascuno ha esplorato il codebase in profondita' e prodotto un piano di implementazione dettagliato con architettura, file checklist, schema DB, endpoint API, componenti frontend e i18n. **Plan 01 — Automated Daily Digest** (`plans/01-automated-daily-digest.md`): GitHub Action (disabled, demo) che chiama un nuovo endpoint bulk `POST /notifications/daily-digest/bulk` autenticato via `X-API-Key` (non JWT) sul backend Vercel. Itera tutti gli utenti con `daily_digest=True`, genera digest per ciascuno con `EmailService.generate_daily_digest()`, ritorna report (sent/skipped/failed). Cron a 07:00 UTC = 09:00 CEST. 4 file (2 modify + 1 create + test). **Plan 02 — AI Skills Gap Analyzer** (`plans/02-ai-skills-gap-dashboard.md`): dashboard interattiva `/it/skill-gap` che incrocia le skill dell'utente con i dati del mercato. Approccio ibrido: conteggio algoritmico della domanda da `Job.tags` + Gemini per insight personalizzati. Color-coding: verde=in demand, giallo=stabile, rosso=declining. 3 nuovi endpoint AI, prompt template dedicato, 10 file nuovi + 7 modificati. **Plan 03 — AI Agent Readiness Score** (`plans/03-ai-readiness-score.md`): quiz di autovalutazione con 8 domande su competenze AI/agentiche. Scoring deterministico (0-100%), 4 livelli (beginner/intermediate/advanced/expert). Nuovo modello `AIReadinessAssessment` + campi denormalizzati su User per filtro rapido nel marketplace talenti. 4 endpoint sotto `profile/ai_readiness/`, integrazione con TalentCard, TalentiPage (filtro), TalentHero. 9 file nuovi + 17 modificati. **Plan 04 — Reskilling Roadmaps** (`plans/04-reskilling-roadmaps.md`): percorsi di apprendimento AI-generati per transizioni di carriera. 6 nuovi modelli DB (Roadmap, RoadmapWeek, RoadmapWeekCourse, UserRoadmap, UserRoadmapProgress, RoadmapMilestone). 9 endpoint API, generazione Gemini con matching corsi, sistema XP dedicato (indipendente da ProposalMilestone), 4 nuove pagine frontend, GitHub Action notturna. 37 file nuovi + 8 modificati. La feature piu' complessa (~6-7 sessioni stimate). Tutti i piani salvati in `/plans/` e README aggiornato con la sezione "Planned Features"
- **Implementazione Automated Daily Digest (Plan 01)**: implementato il piano `plans/01-automated-daily-digest.md` — nuovo endpoint bulk e GitHub Action. **Backend**: (1) 2 nuovi schema Pydantic in `schemas.py` — `BulkDigestError` (user_id + error message) e `BulkDigestResponse` (sent/skipped/failed/total/errors); (2) nuovo endpoint `POST /notifications/daily-digest/bulk` in `router.py` — autenticazione via header `X-API-Key` con `hmac.compare_digest()` per confronto constant-time (prevenzione timing attack), query di tutti gli utenti con `daily_digest=True` in `NotificationPreference` PIU' utenti senza record (default=True), iterazione con error isolation per utente (try/except, un fallimento non blocca gli altri), cap a 10 errori nel response, logging strutturato con structlog; (3) import `hmac` e `BulkDigestResponse` aggiunti al router. **GitHub Action**: `daily-digest.yml` con `workflow_dispatch` per trigger manuale + cron commentato `0 7 * * *` (07:00 UTC = 09:00 CEST in estate / 08:00 CET in inverno). Nessun checkout necessario — semplice `curl` all'endpoint Vercel con API key da GitHub Secrets. Parse response JSON con python3, report in annotations (notice per successo, warning per fallimenti). **Test**: 10 nuovi test — 8 endpoint test (503 missing env, 401 invalid/missing key, success con opted-in users, utenti senza preferences inclusi, partial failure continua, skipped quando None, zero users) + 2 schema test (response base e con errors). **Totale test: 424 (da 413), tutti passanti**. Decisione architetturale: l'endpoint e' public (no JWT) con API key perche' il GitHub Action non ha un utente da autenticare — e' una chiamata di sistema/cron
- **PR Review + E2E Testing Completo (Fase 3-4 Ralph Loop)**: eseguite 2 review parallele (BE + FE) e test E2E completo con 33 scenari. **BE Reviewer (3 fix, +4 test = 397 totali)**: (M1) validazione `TelegramLinkRequest.chat_id` con `Field(min_length=1, max_length=50, pattern=r"^-?\d+$")` + 4 nuovi test per empty/non-numeric/too-long/valid-negative; (M2) migrazione Pydantic `class Config` -> `model_config = ConfigDict(from_attributes=True)` in schemas.py; (M3) OpenAPI server URL corretto da 8000 a 8003. **FE Reviewer (3 fix)**: (C1) prevenzione XSS — installato `isomorphic-dompurify`, wrappato `dangerouslySetInnerHTML` con `DOMPurify.sanitize()` in EmailDetailDialog; (H1) stale closure in `fetchEmail` — rimosso `emails` dalla dependency array, usato `setEmails(prev => ...)` functional update; (H2) `markAsRead` decrementava unreadCount incondizionatamente — aggiunto check `existing.is_read === false`. **E2E Testing (33 scenari, tutti PASS)**: (1-8) Talent flow: login marco.rossi, 3 email con 2 non lette, detail dialog con DOMPurify HTML, mark as read con badge update, filtri Non lette/Traguardi/Proposte, mark all as read; (9-17) Preferenze + Telegram: toggle email/digest, collega Telegram (3-step wizard, input chat_id "123456789"), Chat ID mascherato "****6789", toggle Telegram on/off con feedback "Preferenze salvate!", scollega Telegram, genera digest con nuova email in lista; (18-19) Profilo + Auth: sezione preferenze in pagina profilo, redirect /notifiche -> /login per utenti non autenticati; (20-25) Company user: login hr@techflow.it con badge "Notifiche 2", 2 email company-specifiche (corso iniziato + proposta accettata), filtro Assunzioni empty state, mark all as read con badge che si azzera; (26-32) API edge cases: 401 su 3 endpoint senza auth, validazione chat_id (422 per empty/non-numeric/too-long, 200 per negative group ID), mark single/all read via API, preferences CRUD + telegram unlink, 404 per email inesistenti/UUID invalidi; (33) Cross-user isolation: company non vede email talent (404, non 403 per sicurezza). **Bug minore trovato**: il badge navbar non si aggiorna istantaneamente dopo "Segna tutte come lette" — richiede navigazione per rinfrescare il conteggio (issue di sincronizzazione tra useEmails locale e useUnreadCount globale con polling a 60s)
- **Rimozione clsx, uso diretto di twMerge (Plan A)**: rimossa la dipendenza `clsx` dal frontend. La funzione `cn()` in `utils.ts` ora wrappa direttamente `twMerge` senza passare per `clsx`. Motivazione: `twMerge` accetta gia' stringhe, array e valori falsy tramite il tipo `ClassNameValue`, rendendo `clsx` ridondante. L'unica feature aggiuntiva di clsx era la sintassi oggetto `{ 'class': condition }`, ma nessun componente la usava — tutti usano gia' `condition && 'class'`. Verificato: zero import di `clsx` nel codebase tranne `utils.ts`, zero pattern `cn({...})`. Aggiornato l'agente FE feature-builder (Rule 5) per documentare che `cn()` usa `twMerge` direttamente e non supporta la sintassi oggetto. Typecheck passa senza errori
- **Split models.py in file per-dominio (Plan C)**: suddiviso il monolitico `api/database/models.py` (309 righe, 15 modelli) in 9 file per-dominio sotto `api/database/models/`. Mapping: `user.py` (User), `profile.py` (Experience, Education), `jobs.py` (Job), `applications.py` (Application), `proposals.py` (Proposal, ProposalCourse, ProposalMilestone, ProposalMessage), `news.py` (News), `courses.py` (Course), `ai.py` (AICache), `notifications.py` (EmailLog, NotificationPreference). L'`__init__.py` del package ri-esporta tutti i 15 modelli, garantendo backward-compatibility — nessun file consumatore ha richiesto modifiche (27+ file con `from api.database.models import ...` funzionano identicamente). Le ForeignKey SQLAlchemy usano tablename (`"users.id"`) e non il percorso Python del modulo, quindi lo split non rompe le relazioni FK. Aggiornato l'agente BE feature-builder (Step 3) con la nuova struttura per-dominio, template per nuovi modelli e regola che ogni nuovo modello deve essere ri-esportato dall'`__init__.py`. Tutti i 424 test passanti senza modifiche
- **Split traduzioni in file per-dominio (Plan B)**: suddiviso il monolitico `messages/it.json` in 13 file domain-based sotto `messages/it/` (common, auth, home, applications, talents, craft-your-developer, jobs, news, courses, profile, proposals, industry, notifications). Aggiornato `src/i18n/request.ts` per caricare tutti i file via `Promise.all` e mergarli in un unico oggetto messages. Eliminati tutti gli hardcoded Italian strings trovati: `formatSalary()` e `workModeLabel()` in `job-utils.ts` ora accettano un parametro `t` (translation function) obbligatorio invece di avere stringhe italiane inline ("da", "fino a", "Full Remote", "Ibrido", "In Sede"); `JobCard.tsx`, `JobDetailDialog.tsx` e `ApplicationCard.tsx` aggiornati per passare `t` e usare le chiavi di traduzione per employment type ("Full Time", "Part Time") e experience label ("Esperienza:"). Aggiunte nuove chiavi traduzione in `jobs.json` (`salary.from`, `salary.upTo`, `workModes.*`, `card.experienceLabel`, `card.fullTime`, `card.partTime`). Aggiornati entrambi gli agenti FE (feature-builder Rule 6 e code-reviewer) con la nuova struttura split delle traduzioni e le istruzioni per aggiungere nuovi file di traduzione
- **Estrazione props in file separati (Plan D)**: estratte le interfacce props da ~36 componenti in file `.props.ts` separati, seguendo il pattern documentato nell'agente FE feature-builder. Copertura: tutti i componenti in notifiche, profilo, talenti, proposte, azienda, jobs, courses, news e candidature con props inline. Ogni `.props.ts` esporta solo l'interfaccia props e i tipi da cui dipende, i componenti importano dal file `.props.ts`. Corretto anche un bug in `CourseDetailDialog.tsx` (tag di chiusura duplicati che causavano errore TypeScript). TypeScript check passato senza errori
- **Fix E2E test privacy toggle**: i test `talents.spec.ts` per il privacy toggle fallivano perche' la pagina profilo ora ha 3 `role="switch"` (privacy + email notifications + telegram) invece di 1. Aggiornati i selettori da `page.locator('[role="switch"]')` a `page.getByRole('switch', { name: /Visibilit/i })` per selezionare specificamente il toggle della privacy. Tutti i 65 test E2E passanti
- **Code review finale (BE + FE)**: eseguite 2 review parallele con agenti specializzati. BE review: approvato senza issue — split modelli corretto, 424 test passanti, backward-compatibility verificata. FE review: approvato con 1 CRITICAL fixato (employment_type fallback per part-time non tradotto, aggiunto `t('card.partTime')`), e 3 MEDIUM fixati (React import in news/Badge.props.ts, parametro `t` reso obbligatorio in formatSalary/workModeLabel per eliminare fallback hardcoded). Tutti i fix verificati con typecheck e E2E test suite completa
